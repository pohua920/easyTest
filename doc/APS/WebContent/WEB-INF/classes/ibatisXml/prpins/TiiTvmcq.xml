<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<!-- mantis：CAR0427，處理人員：BJ085，需求單編號：CAR0427 機車強制車險重新投保發對接功能-第四次明信片 -->
<sqlMap namespace="TiiTvmcq" >
  <resultMap id="BaseResultMap" class="com.tlg.prpins.entity.TiiTvmcq" >
    <result column="ID" property="id" jdbcType="DECIMAL" />
    <result column="BARCODE1" property="barcode1" jdbcType="VARCHAR" />
    <result column="BARCODE2" property="barcode2" jdbcType="VARCHAR" />
    <result column="BARCODE3" property="barcode3" jdbcType="VARCHAR" />
    <result column="BILLDUEDATE" property="billduedate" jdbcType="VARCHAR" />
    <result column="INSUREDCARDNO" property="insuredcardno" jdbcType="VARCHAR" />
    <result column="CARNO" property="carno" jdbcType="VARCHAR" />
    <result column="INSFEE" property="insfee" jdbcType="VARCHAR" />
    <result column="OPERATEDATE" property="operatedate" jdbcType="TIMESTAMP" />
    <result column="FILENAME" property="filename" jdbcType="VARCHAR" />
    <result column="PROPOSALNO" property="proposalno" jdbcType="VARCHAR" />
    <result column="CHECKTYPE" property="checktype" jdbcType="VARCHAR" />
    <result column="BATCHNO" property="batchno" jdbcType="VARCHAR" />
  </resultMap>

  <!-- mantis：CAR0554，處理人員：DP0714，APS-TVBCM&TVMCQ作業通知信調整 start -->
  <resultMap id="TiiTvmcqResultMap2" class="com.tlg.aps.vo.TiiTvmcqVo">
    <result column="ID" property="id" jdbcType="DECIMAL" />
    <result column="BARCODE1" property="barcode1" jdbcType="VARCHAR" />
    <result column="BARCODE2" property="barcode2" jdbcType="VARCHAR" />
    <result column="BARCODE3" property="barcode3" jdbcType="VARCHAR" />
    <result column="BILLDUEDATE" property="billduedate" jdbcType="VARCHAR" />
    <result column="INSUREDCARDNO" property="insuredcardno" jdbcType="VARCHAR" />
    <result column="CARNO" property="carno" jdbcType="VARCHAR" />
    <result column="INSFEE" property="insfee" jdbcType="VARCHAR" />
    <result column="OPERATEDATE" property="operatedate" jdbcType="TIMESTAMP" />
    <result column="FILENAME" property="filename" jdbcType="VARCHAR" />
    <result column="PROPOSALNO" property="proposalno" jdbcType="VARCHAR" />
    <result column="CHECKTYPE" property="checktype" jdbcType="VARCHAR" />
    <result column="BATCHNO" property="batchno" jdbcType="VARCHAR" />
    <result column="UNDERWRITEFLAG" property="underWriteFlag" jdbcType="VARCHAR" />
    <result column="PRINTVIRTUALCODE" property="printvirtualcode" jdbcType="VARCHAR" />
  </resultMap>

  <select id="selectTiiTvmcq2" resultMap="TiiTvmcqResultMap2">
    select a.*,b.UNDERWRITEFLAG,c.PRINTVIRTUALCODE from tii_TVMCQ a
    LEFT OUTER JOIN prpqmain b ON b.PROPOSALNO=a.PROPOSALNO
    LEFT OUTER JOIN prpdprint c ON c.PROPOSALNO=a.PROPOSALNO
    where to_char(a.OPERATEDATE,'YYYYMMDD')= TO_CHAR(sysdate-1,'YYYYMMDD')
  </select>
  <!-- mantis：CAR0554，處理人員：DP0714，APS-TVBCM&TVMCQ作業通知信調整 end -->

  <select id="select" resultMap="BaseResultMap" parameterClass="java.util.Map">
  	<include refid="Utils.sql1" />
  	SELECT * FROM <include refid="Utils.prpinsSchema"/>TII_TVMCQ
  	<dynamic prepend="WHERE">
  		<isNotEmpty prepend="AND" property="insuredcardno">
  			INSUREDCARDNO = #insuredcardno#
		</isNotEmpty>
  		<isNotEmpty prepend="AND" property="carno">
  			CARNO = #carno#
		</isNotEmpty>
  		<isNotEmpty prepend="AND" property="filename">
  			FILENAME = #filename#
		</isNotEmpty>
  		<isNotEmpty prepend="AND" property="batchno">
  			BATCHNO = #batchno#
		</isNotEmpty>
	</dynamic>
	<include refid="Utils.sql2" />
  </select>

  <select id="selectByParams" resultMap="BaseResultMap" parameterClass="java.util.Map">
	SELECT * FROM <include refid="Utils.prpinsSchema"/>TII_TVMCQ
	<dynamic prepend="WHERE">
  		<isNotEmpty prepend="AND" property="insuredcardno">
  			INSUREDCARDNO = #insuredcardno#
		</isNotEmpty>
  		<isNotEmpty prepend="AND" property="carno">
  			CARNO = #carno#
		</isNotEmpty>
  		<isNotEmpty prepend="AND" property="filename">
  			FILENAME = #filename#
		</isNotEmpty>
  		<isNotEmpty prepend="AND" property="batchno">
  			BATCHNO = #batchno#
		</isNotEmpty>
  		<isNotEmpty prepend="AND" property="lastOperatedate">
  			TO_CHAR(OPERATEDATE,'YYYYMMDD') = #lastOperatedate# ORDER BY ID
		</isNotEmpty>
	</dynamic>
  </select>
	
  <select id="count" resultClass="java.lang.Integer" parameterClass="java.util.Map">
	SELECT COUNT(*) FROM <include refid="Utils.prpinsSchema"/>TII_TVMCQ
	<dynamic prepend="WHERE">
  		<isNotEmpty prepend="AND" property="insuredcardno">
  			INSUREDCARDNO = #insuredcardno#
		</isNotEmpty>
  		<isNotEmpty prepend="AND" property="carno">
  			CARNO = #carno#
		</isNotEmpty>
  		<isNotEmpty prepend="AND" property="filename">
  			FILENAME = #filename#
		</isNotEmpty>
  		<isNotEmpty prepend="AND" property="batchno">
  			BATCHNO = #batchno#
		</isNotEmpty>
	</dynamic>
  </select>
  
  <select id="selectMaxID" resultClass="java.lang.Integer">
	SELECT MAX(ID) FROM <include refid="Utils.prpinsSchema"/>TII_TVMCQ
  </select>
  
  <insert id="insert" parameterClass="com.tlg.prpins.entity.TiiTvmcq" >
    insert into <include refid="Utils.prpinsSchema"/>TII_TVMCQ 
      (ID, BARCODE1, BARCODE2, BARCODE3, BILLDUEDATE, INSUREDCARDNO, CARNO,
      INSFEE, OPERATEDATE, FILENAME, PROPOSALNO, CHECKTYPE, BATCHNO)
    values (#id:DECIMAL#, #barcode1:VARCHAR#, #barcode2:VARCHAR#, #barcode3:VARCHAR#,
      #billduedate:VARCHAR#, #insuredcardno:VARCHAR#, #carno:VARCHAR#, #insfee:VARCHAR#,
      #operatedate:TIMESTAMP#, #filename:VARCHAR#, #proposalno:VARCHAR#, #checktype:VARCHAR#,
      #batchno:VARCHAR#)
  </insert>

  <update id="update" parameterClass="com.tlg.prpins.entity.TiiTvmcq" >
    update <include refid="Utils.prpinsSchema"/>TII_TVMCQ
    <dynamic prepend="set" >
      <isNotNull prepend="," property="id" >
        ID = #id:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="barcode1" >
        BARCODE1 = #barcode1:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="barcode2" >
        BARCODE2 = #barcode2:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="barcode3" >
        BARCODE3 = #barcode3:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="billduedate" >
        BILLDUEDATE = #billduedate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="insuredcardno" >
        INSUREDCARDNO = #insuredcardno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="carno" >
        CARNO = #carno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="insfee" >
        INSFEE = #insfee:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="operatedate" >
        OPERATEDATE = #operatedate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="filename" >
        FILENAME = #filename:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="proposalno" >
        PROPOSALNO = #proposalno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="checktype" >
        CHECKTYPE = #checktype:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="batchno" >
        BATCHNO = #batchno:VARCHAR#
      </isNotNull>
    </dynamic>
    WHERE　ID = #id:DECIMAL#
  </update>
</sqlMap>