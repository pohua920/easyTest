<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<!-- mantis：FIR0455，處理人員：BJ085，需求單編號：FIR0455 住火-APS富邦續件處理作業 -->
<sqlMap namespace="FirAgtrnTmpFb" >
  <resultMap id="BaseResultMap" class="com.tlg.prpins.entity.FirAgtrnTmpFb" >
    <result column="OID" property="oid" jdbcType="DECIMAL" />
    <result column="BATCH_NO" property="batchNo" jdbcType="VARCHAR" />
    <result column="BATCH_SEQ" property="batchSeq" jdbcType="DECIMAL" />
    <result column="FILENAME" property="filename" jdbcType="VARCHAR" />
    <result column="RAWDATA" property="rawdata" jdbcType="VARCHAR" />
    <result column="P_STATUS" property="pStatus" jdbcType="VARCHAR" />
    <result column="DIFF_FLAG" property="diffFlag" jdbcType="VARCHAR" />
    <result column="DIFF_REASON" property="diffReason" jdbcType="VARCHAR" />
    <result column="FB_POLICYNO_F" property="fbPolicynoF" jdbcType="VARCHAR" />
    <result column="FB_POLICYNO_Q" property="fbPolicynoQ" jdbcType="VARCHAR" />
    <result column="FB_NAME_I" property="fbNameI" jdbcType="VARCHAR" />
    <result column="FB_ID_I" property="fbIdI" jdbcType="VARCHAR" />
    <result column="FB_STARTDATE" property="fbStartdate" jdbcType="TIMESTAMP" />
    <result column="FB_ENDDATE" property="fbEnddate" jdbcType="TIMESTAMP" />
    <result column="FB_ADDRESS" property="fbAddress" jdbcType="VARCHAR" />
    <result column="FB_MORTGAGEE" property="fbMortgagee" jdbcType="VARCHAR" />
    <result column="FB_WALLNO" property="fbWallno" jdbcType="VARCHAR" />
    <result column="FB_SUMFLOORS" property="fbSumfloors" jdbcType="VARCHAR" />
    <result column="FB_BUILDAREA" property="fbBuildarea" jdbcType="VARCHAR" />
    <result column="FB_USE_NATURE" property="fbUseNature" jdbcType="VARCHAR" />
    <result column="FB_AMOUNT_F" property="fbAmountF" jdbcType="VARCHAR" />
    <result column="FB_AMOUNT_Q" property="fbAmountQ" jdbcType="VARCHAR" />
    <result column="FB_COL_INSURC_NO" property="fbColInsurcNo" jdbcType="VARCHAR" />
    <result column="FB_ID_A" property="fbIdA" jdbcType="VARCHAR" />
    <result column="FB_NAME_A" property="fbNameA" jdbcType="VARCHAR" />
    <result column="FB_INS_COM" property="fbInsCom" jdbcType="VARCHAR" />
    <result column="FB_PROCESS_CENTER" property="fbProcessCenter" jdbcType="VARCHAR" />
    <result column="FB_SALES_NAME" property="fbSalesName" jdbcType="VARCHAR" />
    <result column="FB_SALES_ID" property="fbSalesId" jdbcType="VARCHAR" />
    <result column="NAME_I" property="nameI" jdbcType="VARCHAR" />
    <result column="ID_I" property="idI" jdbcType="VARCHAR" />
    <result column="STARTDATE" property="startdate" jdbcType="TIMESTAMP" />
    <result column="ENDDATE" property="enddate" jdbcType="TIMESTAMP" />
    <result column="ADDRESSDETAILINFO" property="addressdetailinfo" jdbcType="VARCHAR" />
    <result column="WALLNO" property="wallno" jdbcType="VARCHAR" />
    <result column="SUMFLOORS" property="sumfloors" jdbcType="DECIMAL" />
    <result column="BUILDAREA" property="buildarea" jdbcType="VARCHAR" />
    <result column="AMOUNT_F" property="amountF" jdbcType="DECIMAL" />
    <result column="AMOUNT_Q" property="amountQ" jdbcType="DECIMAL" />
    <result column="ID_A" property="idA" jdbcType="VARCHAR" />
    <result column="NAME_A" property="nameA" jdbcType="VARCHAR" />
    <result column="ICREATE" property="icreate" jdbcType="VARCHAR" />
    <result column="DCREATE" property="dcreate" jdbcType="TIMESTAMP" />
    <result column="IUPDATE" property="iupdate" jdbcType="VARCHAR" />
    <result column="DUPDATE" property="dupdate" jdbcType="TIMESTAMP" />
  </resultMap>
  
  <resultMap id="fbDiffFileResultMap" class="com.tlg.aps.vo.Aps034genFileVo" >
    <result column="OID" property="oid" jdbcType="DECIMAL" />
    <result column="BATCH_NO" property="batchNo" jdbcType="VARCHAR" />
    <result column="BATCH_SEQ" property="batchSeq" jdbcType="DECIMAL" />
    <result column="FILENAME" property="filename" jdbcType="VARCHAR" />
    <result column="RAWDATA" property="rawdata" jdbcType="VARCHAR" />
    <result column="P_STATUS" property="pStatus" jdbcType="VARCHAR" />
    <result column="DIFF_FLAG" property="diffFlag" jdbcType="VARCHAR" />
    <result column="DIFF_REASON" property="diffReason" jdbcType="VARCHAR" />
    <result column="FB_POLICYNO_F" property="fbPolicynoF" jdbcType="VARCHAR" />
    <result column="FB_POLICYNO_Q" property="fbPolicynoQ" jdbcType="VARCHAR" />
    <result column="FB_NAME_I" property="fbNameI" jdbcType="VARCHAR" />
    <result column="FB_ID_I" property="fbIdI" jdbcType="VARCHAR" />
    <result column="FB_STARTDATE" property="fbStartdate" jdbcType="TIMESTAMP" />
    <result column="FB_ENDDATE" property="fbEnddate" jdbcType="TIMESTAMP" />
    <result column="FB_ADDRESS" property="fbAddress" jdbcType="VARCHAR" />
    <result column="FB_MORTGAGEE" property="fbMortgagee" jdbcType="VARCHAR" />
    <result column="FB_WALLNO" property="fbWallno" jdbcType="VARCHAR" />
    <result column="FB_SUMFLOORS" property="fbSumfloors" jdbcType="VARCHAR" />
    <result column="FB_BUILDAREA" property="fbBuildarea" jdbcType="VARCHAR" />
    <result column="FB_USE_NATURE" property="fbUseNature" jdbcType="VARCHAR" />
    <result column="FB_AMOUNT_F" property="fbAmountF" jdbcType="VARCHAR" />
    <result column="FB_AMOUNT_Q" property="fbAmountQ" jdbcType="VARCHAR" />
    <result column="FB_COL_INSURC_NO" property="fbColInsurcNo" jdbcType="VARCHAR" />
    <result column="FB_ID_A" property="fbIdA" jdbcType="VARCHAR" />
    <result column="FB_NAME_A" property="fbNameA" jdbcType="VARCHAR" />
    <result column="FB_INS_COM" property="fbInsCom" jdbcType="VARCHAR" />
    <result column="FB_PROCESS_CENTER" property="fbProcessCenter" jdbcType="VARCHAR" />
    <result column="FB_SALES_NAME" property="fbSalesName" jdbcType="VARCHAR" />
    <result column="FB_SALES_ID" property="fbSalesId" jdbcType="VARCHAR" />
    <result column="NAME_I" property="nameI" jdbcType="VARCHAR" />
    <result column="ID_I" property="idI" jdbcType="VARCHAR" />
    <result column="STARTDATE" property="startdate" jdbcType="TIMESTAMP" />
    <result column="ENDDATE" property="enddate" jdbcType="TIMESTAMP" />
    <result column="ADDRESSDETAILINFO" property="addressdetailinfo" jdbcType="VARCHAR" />
    <result column="WALLNO" property="wallno" jdbcType="VARCHAR" />
    <result column="SUMFLOORS" property="sumfloors" jdbcType="DECIMAL" />
    <result column="BUILDAREA" property="buildarea" jdbcType="VARCHAR" />
    <result column="AMOUNT_F" property="amountF" jdbcType="VARCHAR" />
    <result column="AMOUNT_Q" property="amountQ" jdbcType="VARCHAR" />
    <result column="ID_A" property="idA" jdbcType="VARCHAR" />
    <result column="NAME_A" property="nameA" jdbcType="VARCHAR" />
    <result column="ICREATE" property="icreate" jdbcType="VARCHAR" />
    <result column="DCREATE" property="dcreate" jdbcType="TIMESTAMP" />
    <result column="IUPDATE" property="iupdate" jdbcType="VARCHAR" />
    <result column="DUPDATE" property="dupdate" jdbcType="TIMESTAMP" />
    <result column="CODECNAME" property="codecname" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="psResultMap" class="com.tlg.prpins.entity.FirAgtrnTmpFb" >
	<result column="FB_PROCESS_CENTER" property="fbProcessCenter" jdbcType="VARCHAR" />
  </resultMap>

  <select id="select" resultMap="BaseResultMap" parameterClass="java.util.Map">
	<include refid="Utils.sql1" />
		SELECT * FROM <include refid="Utils.prpinsSchema"/>FIR_AGTRN_TMP_FB
	<dynamic prepend="WHERE">
		<isNotEmpty prepend="AND" property="batchNo">
			BATCH_NO = #batchNo#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="batchSeq">
			BATCH_SEQ = #batchSeq#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="filename">
			FILENAME = #filename#
		</isNotEmpty>
	</dynamic>
	<include refid="Utils.sql2" />
  </select>
	
  <select id="selectByParams" resultMap="BaseResultMap" parameterClass="java.util.Map">
	SELECT * FROM <include refid="Utils.prpinsSchema"/>FIR_AGTRN_TMP_FB
	<dynamic prepend="WHERE">
		<isNotEmpty prepend="AND" property="batchNo">
			BATCH_NO = #batchNo#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="batchSeq">
			BATCH_SEQ = #batchSeq#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="filename">
			FILENAME = #filename#
		</isNotEmpty>
		<isNotEmpty prepend="" property="orderByBatchSeq">
			ORDER BY #orderByBatchSeq#
		</isNotEmpty>
	</dynamic>
  </select>
  
  <select id="count" resultClass="java.lang.Integer" parameterClass="java.util.Map">
	SELECT COUNT(*) FROM <include refid="Utils.prpinsSchema"/>FIR_AGTRN_TMP_FB
	<dynamic prepend="WHERE">
		<isNotEmpty prepend="AND" property="batchNo">
			BATCH_NO = #batchNo#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="batchSeq">
			BATCH_SEQ = #batchSeq#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="filename">
			FILENAME = #filename#
		</isNotEmpty>
	</dynamic>
  </select>

  <delete id="delete" parameterClass="com.tlg.prpins.entity.FirAgtrnTmpFb" >
    delete from <include refid="Utils.prpinsSchema"/>FIR_AGTRN_TMP_FB
    where OID = #oid:DECIMAL#
  </delete>
  
  <insert id="insert" parameterClass="com.tlg.prpins.entity.FirAgtrnTmpFb" >
    <selectKey resultClass="java.math.BigDecimal" keyProperty="oid" >    
	    SELECT FIR_AGTRN_TMP_FB_SEQ.NEXTVAL AS OID FROM DUAL    
	</selectKey>
    insert into <include refid="Utils.prpinsSchema"/>FIR_AGTRN_TMP_FB 
      (OID, BATCH_NO, BATCH_SEQ, FILENAME, RAWDATA, P_STATUS, DIFF_FLAG,
      DIFF_REASON, FB_POLICYNO_F, FB_POLICYNO_Q, FB_NAME_I, FB_ID_I, FB_STARTDATE, FB_ENDDATE,
      FB_ADDRESS, FB_MORTGAGEE, FB_WALLNO, FB_SUMFLOORS, FB_BUILDAREA, FB_USE_NATURE, FB_AMOUNT_F,
      FB_AMOUNT_Q, FB_COL_INSURC_NO, FB_ID_A, FB_NAME_A, FB_INS_COM, FB_PROCESS_CENTER,
      FB_SALES_NAME, FB_SALES_ID, NAME_I, ID_I, STARTDATE, ENDDATE, ADDRESSDETAILINFO, WALLNO,
      SUMFLOORS, BUILDAREA, AMOUNT_F, AMOUNT_Q, ID_A, NAME_A, ICREATE, DCREATE, IUPDATE, DUPDATE)
    values (#oid:DECIMAL#, #batchNo:VARCHAR#, #batchSeq:DECIMAL#, #filename:VARCHAR#,
      #rawdata:VARCHAR#, #pStatus:VARCHAR#, #diffFlag:VARCHAR#, #diffReason:VARCHAR#,
      #fbPolicynoF:VARCHAR#, #fbPolicynoQ:VARCHAR#, #fbNameI:VARCHAR#, #fbIdI:VARCHAR#,
      #fbStartdate:TIMESTAMP#, #fbEnddate:TIMESTAMP#, #fbAddress:VARCHAR#, #fbMortgagee:VARCHAR#,
      #fbWallno:VARCHAR#, #fbSumfloors:VARCHAR#, #fbBuildarea:VARCHAR#, #fbUseNature:VARCHAR#,
      #fbAmountF:VARCHAR#, #fbAmountQ:VARCHAR#, #fbColInsurcNo:VARCHAR#, #fbIdA:VARCHAR#,
      #fbNameA:VARCHAR#, #fbInsCom:VARCHAR#, #fbProcessCenter:VARCHAR#, #fbSalesName:VARCHAR#,
      #fbSalesId:VARCHAR#, #nameI:VARCHAR#, #idI:VARCHAR#, #startdate:TIMESTAMP#, #enddate:TIMESTAMP#,
      #addressdetailinfo:VARCHAR#, #wallno:VARCHAR#, #sumfloors:DECIMAL#, #buildarea:VARCHAR#,
      #amountF:DECIMAL#, #amountQ:DECIMAL#, #idA:VARCHAR#, #nameA:VARCHAR#, #icreate:VARCHAR#,
      #dcreate:TIMESTAMP#, #iupdate:VARCHAR#, #dupdate:TIMESTAMP#)
  </insert>
  
  <update id="update" parameterClass="com.tlg.prpins.entity.FirAgtrnTmpFb" >
    update <include refid="Utils.prpinsSchema"/>FIR_AGTRN_TMP_FB
    <dynamic prepend="set" >
      <isNotNull prepend="," property="batchNo" >
        BATCH_NO = #batchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="batchSeq" >
        BATCH_SEQ = #batchSeq:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="filename" >
        FILENAME = #filename:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="rawdata" >
        RAWDATA = #rawdata:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="pStatus" >
        P_STATUS = #pStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="diffFlag" >
        DIFF_FLAG = #diffFlag:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="diffReason" >
        DIFF_REASON = #diffReason:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbPolicynoF" >
        FB_POLICYNO_F = #fbPolicynoF:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbPolicynoQ" >
        FB_POLICYNO_Q = #fbPolicynoQ:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbNameI" >
        FB_NAME_I = #fbNameI:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbIdI" >
        FB_ID_I = #fbIdI:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbStartdate" >
        FB_STARTDATE = #fbStartdate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="fbEnddate" >
        FB_ENDDATE = #fbEnddate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="fbAddress" >
        FB_ADDRESS = #fbAddress:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbMortgagee" >
        FB_MORTGAGEE = #fbMortgagee:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbWallno" >
        FB_WALLNO = #fbWallno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbSumfloors" >
        FB_SUMFLOORS = #fbSumfloors:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbBuildarea" >
        FB_BUILDAREA = #fbBuildarea:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbUseNature" >
        FB_USE_NATURE = #fbUseNature:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbAmountF" >
        FB_AMOUNT_F = #fbAmountF:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbAmountQ" >
        FB_AMOUNT_Q = #fbAmountQ:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbColInsurcNo" >
        FB_COL_INSURC_NO = #fbColInsurcNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbIdA" >
        FB_ID_A = #fbIdA:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbNameA" >
        FB_NAME_A = #fbNameA:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbInsCom" >
        FB_INS_COM = #fbInsCom:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbProcessCenter" >
        FB_PROCESS_CENTER = #fbProcessCenter:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbSalesName" >
        FB_SALES_NAME = #fbSalesName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fbSalesId" >
        FB_SALES_ID = #fbSalesId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="nameI" >
        NAME_I = #nameI:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="idI" >
        ID_I = #idI:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="startdate" >
        STARTDATE = #startdate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="enddate" >
        ENDDATE = #enddate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="addressdetailinfo" >
        ADDRESSDETAILINFO = #addressdetailinfo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="wallno" >
        WALLNO = #wallno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="sumfloors" >
        SUMFLOORS = #sumfloors:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="buildarea" >
        BUILDAREA = #buildarea:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="amountF" >
        AMOUNT_F = #amountF:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="amountQ" >
        AMOUNT_Q = #amountQ:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="idA" >
        ID_A = #idA:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="nameA" >
        NAME_A = #nameA:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="icreate" >
        ICREATE = #icreate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dcreate" >
        DCREATE = #dcreate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="iupdate" >
        IUPDATE = #iupdate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dupdate" >
        DUPDATE = #dupdate:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where BATCH_NO = #batchNo:VARCHAR#
    and BATCH_SEQ = #batchSeq:DECIMAL#
  </update>
  
  <!-- 查詢富邦差異明細資料 -->
  <select id="selectFbDiffFile" resultMap="fbDiffFileResultMap" parameterClass="java.util.Map" >
  	SELECT PCODE.CODECNAME, TFB.* FROM FIR_AGTRN_TMP_FB TFB
	LEFT JOIN CCICDMS.PRPDNEWCODE PCODE ON TFB.WALLNO = PCODE.CODECODE 
	AND PCODE.CODETYPE = 'WallMaterial'
	WHERE TFB.BATCH_NO = #batchNo:VARCHAR# 
	AND TFB.DIFF_FLAG = 'Y'
	ORDER BY TFB.FB_PROCESS_CENTER, TFB.FB_POLICYNO_F, TFB.FB_POLICYNO_Q
  </select>
  
  <!-- 查詢富邦差異明細資料作業中心 -->
  <select id="selectFbProcessCenter" resultMap="psResultMap" parameterClass="java.util.Map" >
  	SELECT DISTINCT TFB.FB_PROCESS_CENTER FROM FIR_AGTRN_TMP_FB TFB
	LEFT JOIN CCICDMS.PRPDNEWCODE PCODE ON TFB.WALLNO = PCODE.CODECODE
	AND PCODE.CODETYPE = 'WallMaterial'
	WHERE TFB.BATCH_NO = #batchNo:VARCHAR#  AND TFB.DIFF_FLAG = 'Y'
	ORDER BY TFB.FB_PROCESS_CENTER
  </select>
  
</sqlMap>