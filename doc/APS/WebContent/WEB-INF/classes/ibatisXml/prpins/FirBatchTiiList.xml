<?xml version="1.0" encoding="UTF-8" ?>
<!-- mantis：FIR0579，處理人員：BJ085，需求單編號：FIR0579 保發中心-住火保批資料產生排程規格 -->
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="FirBatchTiiList" >
  <resultMap id="BaseResultMap" class="com.tlg.prpins.entity.FirBatchTiiList" >
    <result column="OID" property="oid" jdbcType="DECIMAL" />
    <result column="PROC_TYPE" property="procType" jdbcType="VARCHAR" />
    <result column="INSCO_CODE" property="inscoCode" jdbcType="VARCHAR" />
    <result column="BRANCH_CODE" property="branchCode" jdbcType="VARCHAR" />
    <result column="INSCO_CODE_E" property="inscoCodeE" jdbcType="VARCHAR" />
    <result column="BRANCH_CODE_E" property="branchCodeE" jdbcType="VARCHAR" />
    <result column="INS_NO" property="insNo" jdbcType="VARCHAR" />
    <result column="INS_NAME" property="insName" jdbcType="VARCHAR" />
    <result column="POLICYNO" property="policyno" jdbcType="VARCHAR" />
    <result column="ENDORSENO" property="endorseno" jdbcType="VARCHAR" />
    <result column="OLDPOLICYNO" property="oldpolicyno" jdbcType="VARCHAR" />
    <result column="DATA_STATUS" property="dataStatus" jdbcType="VARCHAR" />
    <result column="UNDATE" property="undate" jdbcType="TIMESTAMP" />
    <result column="INSURED_ID_OLD" property="insuredIdOld" jdbcType="VARCHAR" />
    <result column="STARTDATE_OLD" property="startdateOld" jdbcType="TIMESTAMP" />
    <result column="SUMAMOUNT" property="sumamount" jdbcType="DECIMAL" />
    <result column="SUMPREMIUM" property="sumpremium" jdbcType="DECIMAL" />
    <result column="STARTDATE" property="startdate" jdbcType="TIMESTAMP" />
    <result column="ENDDATE" property="enddate" jdbcType="TIMESTAMP" />
    <result column="POLICYNO_STATUS" property="policynoStatus" jdbcType="VARCHAR" />
    <result column="APPLI_COUNT" property="appliCount" jdbcType="DECIMAL" />
    <result column="APPLICANT_ID" property="applicantId" jdbcType="VARCHAR" />
    <result column="APPLICANT_NAME" property="applicantName" jdbcType="VARCHAR" />
    <result column="APPLICANT_ADDR" property="applicantAddr" jdbcType="VARCHAR" />
    <result column="INSURED_COUNT" property="insuredCount" jdbcType="DECIMAL" />
    <result column="INSURED_ID" property="insuredId" jdbcType="VARCHAR" />
    <result column="INSURED_NAME" property="insuredName" jdbcType="VARCHAR" />
    <result column="INSURED_ADDR" property="insuredAddr" jdbcType="VARCHAR" />
    <result column="BANK_COUNT" property="bankCount" jdbcType="DECIMAL" />
    <result column="BANK_DATA" property="bankData" jdbcType="VARCHAR" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
    <result column="ADDR_COUNT" property="addrCount" jdbcType="DECIMAL" />
    <result column="STARTDATE_E" property="startdateE" jdbcType="TIMESTAMP" />
    <result column="ENDDATE_E" property="enddateE" jdbcType="TIMESTAMP" />
    <result column="ENDOR_TEXT" property="endorText" jdbcType="VARCHAR" />
    <result column="PROC_DATE" property="procDate" jdbcType="TIMESTAMP" />
    <result column="ICREATE" property="icreate" jdbcType="VARCHAR" />
    <result column="DCREATE" property="dcreate" jdbcType="TIMESTAMP" />
    <result column="BATCH_NO" property="batchNo" jdbcType="VARCHAR" />
    <result column="IUPDATE" property="iupdate" jdbcType="VARCHAR" />
    <result column="DUPDATE" property="dupdate" jdbcType="TIMESTAMP" />
    <result column="DATA_SOURCE" property="dataSource" jdbcType="VARCHAR" />
    <result column="BATCH_NO_SP" property="batchNoSp" jdbcType="VARCHAR" />
    <result column="AS400_OID" property="as400Oid" jdbcType="DECIMAL" />
  </resultMap>
  
  <resultMap class="com.tlg.aps.vo.FirTiiDataVo" id="CountProcTypeMap">
  	<result column="PROC_TYPE" property="procType" jdbcType="VARCHAR" />
    <result column="NREC" property="nrec" jdbcType="DECIMAL" />
  </resultMap>
  
  <select id="select" parameterClass="java.util.Map" resultMap="BaseResultMap">
  	<include refid="Utils.sql1" />
    select * from <include refid="Utils.prpinsSchema"/>FIR_BATCH_TII_LIST
    <dynamic prepend="WHERE">
	  <isNotNull prepend="AND" property="oid">
        OID = #oid:DECIMAL#
      </isNotNull> 
      <isNotNull prepend="AND" property="batchNo">
        BATCH_NO = #batchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="policyno">
        POLICYNO = #policyno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="endorseno">
        ENDORSENO = #endorseno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="batchNoSp">
        BATCH_NO_SP = #batchNoSp:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="as400Oid">
        AS400_OID = #as400Oid:DECIMAL#
      </isNotNull>
    </dynamic>
    <include refid="Utils.sql2" />
  </select>  
  
  <select id="selectByParams" parameterClass="java.util.Map" resultMap="BaseResultMap">
    select * from <include refid="Utils.prpinsSchema"/>FIR_BATCH_TII_LIST
    <dynamic prepend="WHERE">
	  <isNotNull prepend="AND" property="oid">
        OID = #oid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="AND" property="batchNo">
        BATCH_NO = #batchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="policyno">
        POLICYNO = #policyno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="endorseno">
        ENDORSENO = #endorseno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="batchNoSp">
        BATCH_NO_SP = #batchNoSp:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="as400Oid">
        AS400_OID = #as400Oid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="AND" property="batchNoIsNull">
        BATCH_NO IS NULL
      </isNotNull>
      <!-- mantis：FIR0579，處理人員：BJ085，需求單編號：FIR0579 保發中心-住火保批資料產生排程規格_修正檔案資料排序問題-->
      <isNotNull prepend="ORDER BY" property="sortBy">
        $sortBy$
      </isNotNull>
    </dynamic>
  </select>
  
  <select id="count" parameterClass="java.util.Map" resultClass="java.lang.Integer">
    select COUNT(*) from <include refid="Utils.prpinsSchema"/>FIR_BATCH_TII_LIST
    <dynamic prepend="WHERE">
	  <isNotNull prepend="AND" property="oid">
        OID = #oid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="AND" property="batchNo">
        BATCH_NO = #batchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="policyno">
        POLICYNO = #policyno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="endorseno">
        ENDORSENO = #endorseno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="batchNoSp">
        BATCH_NO_SP = #batchNoSp:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="as400Oid">
        AS400_OID = #as400Oid:DECIMAL#
      </isNotNull>
    </dynamic>
  </select>  
  
  <select id="selectForCountProcType" parameterClass="java.util.Map" resultMap="CountProcTypeMap">
    select PROC_TYPE, COUNT(*) AS NREC from FIR_BATCH_TII_LIST 
    where BATCH_NO_SP = #batchNoSp:VARCHAR#
    group by PROC_TYPE
  </select>  
  
  <delete id="delete" parameterClass="com.tlg.prpins.entity.FirBatchTiiList" >
    delete from <include refid="Utils.prpinsSchema"/>FIR_BATCH_TII_LIST
    where OID = #oid:DECIMAL#
  </delete>
  
  <insert id="insert" parameterClass="com.tlg.prpins.entity.FirBatchTiiList" >
    <selectKey resultClass="java.math.BigDecimal" keyProperty="oid" >    
	  SELECT FIR_BATCH_TII_LIST_SEQ.NEXTVAL AS OID FROM DUAL    
	</selectKey>
    insert into <include refid="Utils.prpinsSchema"/>FIR_BATCH_TII_LIST 
    (OID, PROC_TYPE, INSCO_CODE, BRANCH_CODE, INSCO_CODE_E,
      BRANCH_CODE_E, INS_NO, INS_NAME, POLICYNO, ENDORSENO, OLDPOLICYNO, DATA_STATUS, UNDATE,
      INSURED_ID_OLD, STARTDATE_OLD, SUMAMOUNT, SUMPREMIUM, STARTDATE, ENDDATE, POLICYNO_STATUS,
      APPLI_COUNT, APPLICANT_ID, APPLICANT_NAME, APPLICANT_ADDR, INSURED_COUNT, INSURED_ID,
      INSURED_NAME, INSURED_ADDR, BANK_COUNT, BANK_DATA, REMARK, ADDR_COUNT, STARTDATE_E, ENDDATE_E,
      ENDOR_TEXT, PROC_DATE, ICREATE, DCREATE, BATCH_NO, IUPDATE, DUPDATE, DATA_SOURCE, BATCH_NO_SP,
      AS400_OID)
    values (#oid:DECIMAL#, #procType:VARCHAR#, #inscoCode:VARCHAR#, #branchCode:VARCHAR#,
      #inscoCodeE:VARCHAR#, #branchCodeE:VARCHAR#, #insNo:VARCHAR#, #insName:VARCHAR#,
      #policyno:VARCHAR#, #endorseno:VARCHAR#, #oldpolicyno:VARCHAR#, #dataStatus:VARCHAR#,
      #undate:TIMESTAMP#, #insuredIdOld:VARCHAR#, #startdateOld:TIMESTAMP#, #sumamount:DECIMAL#,
      #sumpremium:DECIMAL#, #startdate:TIMESTAMP#, #enddate:TIMESTAMP#, #policynoStatus:VARCHAR#,
      #appliCount:DECIMAL#, #applicantId:VARCHAR#, #applicantName:VARCHAR#, #applicantAddr:VARCHAR#,
      #insuredCount:DECIMAL#, #insuredId:VARCHAR#, #insuredName:VARCHAR#, #insuredAddr:VARCHAR#,
      #bankCount:DECIMAL#, #bankData:VARCHAR#, #remark:VARCHAR#, #addrCount:DECIMAL#,
      #startdateE:TIMESTAMP#, #enddateE:TIMESTAMP#, #endorText:VARCHAR#, #procDate:TIMESTAMP#,
      #icreate:VARCHAR#, #dcreate:TIMESTAMP#, #batchNo:VARCHAR#, #iupdate:VARCHAR#,
      #dupdate:TIMESTAMP#, #dataSource:VARCHAR#, #batchNoSp:VARCHAR#, #as400Oid:DECIMAL#)
  </insert>

  <update id="update" parameterClass="com.tlg.prpins.entity.FirBatchTiiList" >
    update <include refid="Utils.prpinsSchema"/>FIR_BATCH_TII_LIST
    <dynamic prepend="set" >
      <isNotNull prepend="," property="procType" >
        PROC_TYPE = #procType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="inscoCode" >
        INSCO_CODE = #inscoCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="branchCode" >
        BRANCH_CODE = #branchCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="inscoCodeE" >
        INSCO_CODE_E = #inscoCodeE:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="branchCodeE" >
        BRANCH_CODE_E = #branchCodeE:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="insNo" >
        INS_NO = #insNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="insName" >
        INS_NAME = #insName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="policyno" >
        POLICYNO = #policyno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="endorseno" >
        ENDORSENO = #endorseno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="oldpolicyno" >
        OLDPOLICYNO = #oldpolicyno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dataStatus" >
        DATA_STATUS = #dataStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="undate" >
        UNDATE = #undate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="insuredIdOld" >
        INSURED_ID_OLD = #insuredIdOld:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="startdateOld" >
        STARTDATE_OLD = #startdateOld:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="sumamount" >
        SUMAMOUNT = #sumamount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="sumpremium" >
        SUMPREMIUM = #sumpremium:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="startdate" >
        STARTDATE = #startdate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="enddate" >
        ENDDATE = #enddate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="policynoStatus" >
        POLICYNO_STATUS = #policynoStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="appliCount" >
        APPLI_COUNT = #appliCount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="applicantId" >
        APPLICANT_ID = #applicantId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="applicantName" >
        APPLICANT_NAME = #applicantName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="applicantAddr" >
        APPLICANT_ADDR = #applicantAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="insuredCount" >
        INSURED_COUNT = #insuredCount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="insuredId" >
        INSURED_ID = #insuredId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="insuredName" >
        INSURED_NAME = #insuredName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="insuredAddr" >
        INSURED_ADDR = #insuredAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="bankCount" >
        BANK_COUNT = #bankCount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="bankData" >
        BANK_DATA = #bankData:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        REMARK = #remark:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="addrCount" >
        ADDR_COUNT = #addrCount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="startdateE" >
        STARTDATE_E = #startdateE:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="enddateE" >
        ENDDATE_E = #enddateE:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="endorText" >
        ENDOR_TEXT = #endorText:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="procDate" >
        PROC_DATE = #procDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="icreate" >
        ICREATE = #icreate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dcreate" >
        DCREATE = #dcreate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="batchNo" >
        BATCH_NO = #batchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="iupdate" >
        IUPDATE = #iupdate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dupdate" >
        DUPDATE = #dupdate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="dataSource" >
        DATA_SOURCE = #dataSource:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="batchNoSp" >
        BATCH_NO_SP = #batchNoSp:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="as400Oid" >
        AS400_OID = #as400Oid:DECIMAL#
      </isNotNull>
    </dynamic>
    where OID = #oid:DECIMAL#
  </update>
</sqlMap>