<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PrplClaim">

	<resultMap id="BaseResultMap" class="com.tlg.prpins.entity.PrplClaim" >
	    <result column="CLAIMNO" jdbcType="VARCHAR" property="claimno" />
	    <result column="LFLAG" jdbcType="VARCHAR" property="lflag" />
	    <result column="CASENO" jdbcType="VARCHAR" property="caseno" />
	    <result column="CLASSCODE" jdbcType="VARCHAR" property="classcode" />
	    <result column="RISKCODE" jdbcType="VARCHAR" property="riskcode" />
	    <result column="REGISTNO" jdbcType="VARCHAR" property="registno" />
	    <result column="POLICYNO" jdbcType="VARCHAR" property="policyno" />
	    <result column="BUSINESSNATURE" jdbcType="VARCHAR" property="businessnature" />
	    <result column="LANGUAGE" jdbcType="VARCHAR" property="language" />
	    <result column="POLICYTYPE" jdbcType="VARCHAR" property="policytype" />
	    <result column="INSUREDCODE" jdbcType="VARCHAR" property="insuredcode" />
	    <result column="INSUREDNAME" jdbcType="VARCHAR" property="insuredname" />
	    <result column="STARTDATE" jdbcType="TIMESTAMP" property="startdate" />
	    <result column="STARTHOUR" jdbcType="DECIMAL" property="starthour" />
	    <result column="ENDDATE" jdbcType="TIMESTAMP" property="enddate" />
	    <result column="ENDHOUR" jdbcType="DECIMAL" property="endhour" />
	    <result column="CURRENCY" jdbcType="VARCHAR" property="currency" />
	    <result column="SUMAMOUNT" jdbcType="DECIMAL" property="sumamount" />
	    <result column="SUMPREMIUM" jdbcType="DECIMAL" property="sumpremium" />
	    <result column="SUMQUANTITY" jdbcType="DECIMAL" property="sumquantity" />
	    <result column="DAMAGESTARTDATE" jdbcType="TIMESTAMP" property="damagestartdate" />
	    <result column="DAMAGESTARTHOUR" jdbcType="VARCHAR" property="damagestarthour" />
	    <result column="DAMAGEENDDATE" jdbcType="TIMESTAMP" property="damageenddate" />
	    <result column="DAMAGEENDHOUR" jdbcType="VARCHAR" property="damageendhour" />
	    <result column="DAMAGECODE" jdbcType="VARCHAR" property="damagecode" />
	    <result column="DAMAGENAME" jdbcType="VARCHAR" property="damagename" />
	    <result column="DAMAGETYPECODE" jdbcType="VARCHAR" property="damagetypecode" />
	    <result column="DAMAGETYPENAME" jdbcType="VARCHAR" property="damagetypename" />
	    <result column="DAMAGEAREACODE" jdbcType="VARCHAR" property="damageareacode" />
	    <result column="DAMAGEAREANAME" jdbcType="VARCHAR" property="damageareaname" />
	    <result column="DAMAGEADDRESSTYPE" jdbcType="VARCHAR" property="damageaddresstype" />
	    <result column="ADDRESSCODE" jdbcType="VARCHAR" property="addresscode" />
	    <result column="DAMAGEADDRESS" jdbcType="VARCHAR" property="damageaddress" />
	    <result column="LOSSNAME" jdbcType="VARCHAR" property="lossname" />
	    <result column="LOSSQUANTITY" jdbcType="DECIMAL" property="lossquantity" />
	    <result column="DAMAGEKIND" jdbcType="VARCHAR" property="damagekind" />
	    <result column="CLAIMDATE" jdbcType="TIMESTAMP" property="claimdate" />
	    <result column="INDEMNITYDUTY" jdbcType="VARCHAR" property="indemnityduty" />
	    <result column="INDEMNITYDUTYRATE" jdbcType="DECIMAL" property="indemnitydutyrate" />
	    <result column="DEDUCTIBLERATE" jdbcType="DECIMAL" property="deductiblerate" />
	    <result column="SUMCLAIM" jdbcType="DECIMAL" property="sumclaim" />
	    <result column="SUMDEFLOSS" jdbcType="DECIMAL" property="sumdefloss" />
	    <result column="SUMPAID" jdbcType="DECIMAL" property="sumpaid" />
	    <result column="SUMREPLEVY" jdbcType="DECIMAL" property="sumreplevy" />
	    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
	    <result column="CASETYPE" jdbcType="VARCHAR" property="casetype" />
	    <result column="MAKECOM" jdbcType="VARCHAR" property="makecom" />
	    <result column="COMCODE" jdbcType="VARCHAR" property="comcode" />
	    <result column="AGENTCODE" jdbcType="VARCHAR" property="agentcode" />
	    <result column="HANDLERCODE" jdbcType="VARCHAR" property="handlercode" />
	    <result column="HANDLER1CODE" jdbcType="VARCHAR" property="handler1code" />
	    <result column="STATISTICSYM" jdbcType="TIMESTAMP" property="statisticsym" />
	    <result column="OPERATORCODE" jdbcType="VARCHAR" property="operatorcode" />
	    <result column="INPUTDATE" jdbcType="TIMESTAMP" property="inputdate" />
	    <result column="ENDCASEDATE" jdbcType="TIMESTAMP" property="endcasedate" />
	    <result column="ENDCASERCODE" jdbcType="VARCHAR" property="endcasercode" />
	    <result column="CANCELDATE" jdbcType="TIMESTAMP" property="canceldate" />
	    <result column="CANCELREASON" jdbcType="VARCHAR" property="cancelreason" />
	    <result column="DEALERCODE" jdbcType="VARCHAR" property="dealercode" />
	    <result column="ESCAPEFLAG" jdbcType="VARCHAR" property="escapeflag" />
	    <result column="FLAG" jdbcType="VARCHAR" property="flag" />
	    <result column="THIRDCOMFLAG" jdbcType="VARCHAR" property="thirdcomflag" />
	    <result column="REPLEVYFLAG" jdbcType="VARCHAR" property="replevyflag" />
	    <result column="CINDEMNITYDUTYRATE" jdbcType="DECIMAL" property="cindemnitydutyrate" />
	    <result column="ENDCASEFLAG" jdbcType="VARCHAR" property="endcaseflag" />
	    <result column="CATASTROPHECODE1" jdbcType="VARCHAR" property="catastrophecode1" />
	    <result column="CATASTROPHENAME1" jdbcType="VARCHAR" property="catastrophename1" />
	    <result column="CATASTROPHECODE2" jdbcType="VARCHAR" property="catastrophecode2" />
	    <result column="CATASTROPHENAME2" jdbcType="VARCHAR" property="catastrophename2" />
	    <result column="DAMAGEAREAPOSTCODE" jdbcType="VARCHAR" property="damageareapostcode" />
	    <result column="CLAIMTYPE" jdbcType="VARCHAR" property="claimtype" />
	    <result column="REPLEVYLIMITDATE" jdbcType="TIMESTAMP" property="replevylimitdate" />
	    <result column="TERMFLAG" jdbcType="VARCHAR" property="termflag" />
	    <result column="STARTAPPLYPAYDATE" jdbcType="TIMESTAMP" property="startapplypaydate" />
	    <result column="REFERLAWFLAG" jdbcType="VARCHAR" property="referlawflag" />
	    <result column="GUARANTEEFLAG" jdbcType="VARCHAR" property="guaranteeflag" />
	    <result column="RECEIPTDATE" jdbcType="VARCHAR" property="receiptdate" />
	    <result column="HANDLEDEPT" jdbcType="VARCHAR" property="handledept" />
	    <result column="CARGONO" jdbcType="VARCHAR" property="cargono" />
	    <result column="CARGONAME" jdbcType="VARCHAR" property="cargoname" />
	    <result column="GENERALAVERAGE" jdbcType="VARCHAR" property="generalaverage" />
	    <result column="TRANSPORTTYPE" jdbcType="VARCHAR" property="transporttype" />
	    <result column="BKWARDSTARTDATE" jdbcType="TIMESTAMP" property="bkwardstartdate" />
	    <result column="PROJECTCODE" jdbcType="VARCHAR" property="projectcode" />
	    <result column="DANGEROUSCLASSSUBITEMNAME" jdbcType="VARCHAR" property="dangerousclasssubitemname" />
	    <result column="DANGEROUSCLASSSUBITEM" jdbcType="VARCHAR" property="dangerousclasssubitem" />
	    <result column="DANGEROUSCLASSITEM" jdbcType="VARCHAR" property="dangerousclassitem" />
	    <result column="BUSINESSCAREERNAME" jdbcType="VARCHAR" property="businesscareername" />
	    <result column="BUSINESSCAREERCODE" jdbcType="VARCHAR" property="businesscareercode" />
	    <result column="CHARGETYPE" jdbcType="VARCHAR" property="chargetype" />
	    <result column="COINSFLAG" jdbcType="VARCHAR" property="coinsflag" />
	    <result column="ENDORSENO" jdbcType="VARCHAR" property="endorseno" />
	    <result column="RELATIONSHIP" jdbcType="VARCHAR" property="relationship" />
	    <result column="ISSUINGBANK" jdbcType="VARCHAR" property="issuingbank" />
	    <result column="CREDITCARDTYPE" jdbcType="VARCHAR" property="creditcardtype" />
	    <result column="CREDITCARDNO" jdbcType="VARCHAR" property="creditcardno" />
	    <result column="DUEDATE" jdbcType="VARCHAR" property="duedate" />
	    <result column="CARDHOLDERNAME" jdbcType="VARCHAR" property="cardholdername" />
	    <result column="CARDHOLDERIDNO" jdbcType="VARCHAR" property="cardholderidno" />
	    <result column="CARDHOLDERTEL" jdbcType="VARCHAR" property="cardholdertel" />
	    <result column="CARDHOLDERPHONE" jdbcType="VARCHAR" property="cardholderphone" />
	    <result column="CARDHOLDERADDRESS" jdbcType="VARCHAR" property="cardholderaddress" />
	    <result column="SIMPLEFLAG" jdbcType="VARCHAR" property="simpleflag" />
	    <result column="REPLEVYREMARK" jdbcType="VARCHAR" property="replevyremark" />
	    <result column="CARACCIDENTTYPE" jdbcType="VARCHAR" property="caraccidenttype" />
	    <result column="PROPACCIDENTTYPE" jdbcType="VARCHAR" property="propaccidenttype" />
	</resultMap>

	<select id="select" resultMap="BaseResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
		SELECT * FROM <include refid="Utils.prpinsSchema"/>PRPLCLAIM
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="oid">
				CLAIMNO = #claimno#
			</isNotEmpty>
		</dynamic>
		<include refid="Utils.sql2" />
	</select>

	<select id="selectByParams" resultMap="BaseResultMap" parameterClass="java.util.Map">
		SELECT * FROM <include refid="Utils.prpinsSchema"/>PRPLCLAIM
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="oid">
				CLAIMNO = #claimno#
			</isNotEmpty>
		</dynamic>
	</select>

 	
	<select id="count" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*) FROM <include refid="Utils.prpinsSchema"/>PRPLCLAIM
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="oid">
				CLAIMNO = #claimno#
			</isNotEmpty>
		</dynamic>
	</select>

	<select id="selectFirClaimByParams" resultClass="java.lang.String" parameterClass="java.util.Map">
		SELECT
		    prpcmain.policyno
		FROM
		    prplclaim, prpcmain
		WHERE
		    prplclaim.policyno = prpcmain.policyno
		    AND EXISTS (
		        SELECT
		            0
		        FROM
		            prpcaddress
		        WHERE
		            prpcaddress.policyno = prpcmain.policyno
		            AND prpcaddress.addressdetailinfo = replace（replace(#address#, ' ', ''),'　','')
		            AND ( ( prpcmain.startdate <![CDATA[>]]> add_months(SYSDATE, - 24)
		                    AND prpcmain.startdate <![CDATA[<=]]> SYSDATE )
		                  OR ( prpcmain.enddate <![CDATA[>]]> add_months(SYSDATE, - 24)
		                       AND prpcmain.enddate <![CDATA[<=]]> SYSDATE ) )
		    )
		    AND prpcmain.riskcode = #riskCode#
		    AND prplclaim.canceldate IS NULL 	<!--註銷/拒賠日期-->
		    AND prplclaim.dealercode IS NULL 	<!--註銷/拒賠人代碼-->
		    AND prplclaim.damagestartdate <![CDATA[>]]> add_months(SYSDATE, - 24)
		    AND ( prplclaim.damagestartdate <![CDATA[>]]> prpcmain.startdate 	<!--出險日期起-->
		          OR ( prplclaim.damagestartdate = prpcmain.startdate
		               AND to_number(substr(prplclaim.damagestarthour, 0, 2)) <![CDATA[>]]> prpcmain.starthour ) )
		    AND ( prplclaim.damagestartdate <![CDATA[<]]> prpcmain.enddate
		          OR ( prplclaim.damagestartdate = prpcmain.enddate
		               AND to_number(substr(prplclaim.damagestarthour, 0, 2)) <![CDATA[<]]> prpcmain.endhour ) )
		    AND NOT EXISTS (
		        SELECT
		            0
		        FROM
		            prpphead
		        WHERE
		            prpphead.policyno = prplclaim.policyno
		            AND ( prplclaim.damagestartdate <![CDATA[>]]> prpphead.validdate
		                  OR ( prplclaim.damagestartdate = prpphead.validdate
		                       AND to_number(substr(prplclaim.damagestarthour, 0, 2)) <![CDATA[>]]> prpphead.validhour ) )
		    ) 
	</select>



</sqlMap>