<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="FirCtbcBatchDtl">
  <resultMap class="com.tlg.prpins.entity.FirCtbcBatchDtl" id="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 19 17:18:25 CST 2020.
    -->
    <result column="BATCH_NO" jdbcType="VARCHAR" property="batchNo" />
    <result column="BATCH_SEQ" jdbcType="VARCHAR" property="batchSeq" />
    <result column="FK_ORDER_SEQ" jdbcType="VARCHAR" property="fkOrderSeq" />
    <result column="ORDER_SEQ_STATUS" jdbcType="VARCHAR" property="orderSeqStatus" />
    <result column="FK_STATUS" jdbcType="VARCHAR" property="fkStatus" />
    <result column="DQUAKE_STATUS" jdbcType="VARCHAR" property="dquakeStatus" />
    <result column="DQUAKE_NO" jdbcType="VARCHAR" property="dquakeNo" />
    <result column="OID_FIR_PREMCALC_TMP" jdbcType="DECIMAL" property="oidFirPremcalcTmp" />
    <result column="FAMT_STATUS" jdbcType="VARCHAR" property="famtStatus" />
    <result column="WS_FIR_AMT" jdbcType="DECIMAL" property="wsFirAmt" />
    <result column="QAMT_STATUS" jdbcType="VARCHAR" property="qamtStatus" />
    <result column="WS_QUAKE_AMT" jdbcType="DECIMAL" property="wsQuakeAmt" />
    <result column="ADDR_STATUS" jdbcType="VARCHAR" property="addrStatus" />
    <result column="ADDR_DETAIL" jdbcType="VARCHAR" property="addrDetail" />
    <result column="IS_TIFF" jdbcType="VARCHAR" property="isTiff" />
    <result column="FILENAME_TIFF" jdbcType="VARCHAR" property="filenameTiff" />
    <result column="CHECK_ERR_MSG" jdbcType="VARCHAR" property="checkErrMsg" />
    <result column="CHECK_WARN_MSG" jdbcType="VARCHAR" property="checkWarnMsg" />
    <result column="TRANS_TMP_TIME" jdbcType="TIMESTAMP" property="transTmpTime" />
    <result column="TRANS_PPS_TIME" jdbcType="TIMESTAMP" property="transPpsTime" />
    <result column="PRINT_CTF_TIME" jdbcType="TIMESTAMP" property="printCtfTime" />
    <result column="POLICYNO" jdbcType="VARCHAR" property="policyno" />
    <result column="CORE_CANCEL_USER" jdbcType="VARCHAR" property="coreCancelUser" />
    <result column="CORE_CANCEL_TIME" jdbcType="TIMESTAMP" property="coreCancelTime" />
    <result column="BK_TIME" jdbcType="TIMESTAMP" property="bkTime" />
    <result column="BK_FILENAME" jdbcType="VARCHAR" property="bkFilename" />
    <result column="BK_TYPE" jdbcType="VARCHAR" property="bkType" />
    <result column="DELETE_FLAG" jdbcType="VARCHAR" property="deleteFlag" />
    <result column="ICREATE" jdbcType="VARCHAR" property="icreate" />
    <result column="DCREATE" jdbcType="TIMESTAMP" property="dcreate" />
    <result column="IUPDATE" jdbcType="VARCHAR" property="iupdate" />
    <result column="DUPDATE" jdbcType="TIMESTAMP" property="dupdate" />
    <!-- mantis：FIR0181， 中信新件流程-排程查詢作業(含產生查詢及回饋查詢) -->
    <result column="PRPINS_BATCH_STATUS" jdbcType="VARCHAR" property="prpinsBatchStatus" />
  </resultMap>
  
    <resultMap class="com.tlg.prpins.entity.FirCtbcRst" id="firCtbcRstResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 19 17:18:25 CST 2020.
    -->
    <!--  
    <result column="BATCH_NO" jdbcType="VARCHAR" property="batchNo" />
    <result column="BATCH_SEQ" jdbcType="VARCHAR" property="batchSeq" />
    <result column="FK_ORDER_SEQ" jdbcType="VARCHAR" property="fkOrderSeq" />
    <result column="RST_TYPE" jdbcType="VARCHAR" property="rstType" />
    <result column="INSCO_STATUS" jdbcType="VARCHAR" property="inscoStatus" />
    <result column="INSCO_FEEDBACK" jdbcType="VARCHAR" property="inscoFeedback" />
    <result column="POLICYNO" jdbcType="VARCHAR" property="policyno" />
    <result column="FILENAME_CTF" jdbcType="VARCHAR" property="filenameCtf" />
    -->
    <result column="BATCH_NO" jdbcType="VARCHAR" property="oBatchNo" />
    <result column="BATCH_SEQ" jdbcType="VARCHAR" property="oBatchSeq" />
    <result column="FK_ORDER_SEQ" jdbcType="VARCHAR" property="fkOrderSeq" />
    <result column="RST_TYPE" jdbcType="VARCHAR" property="rstType" />
    <result column="INSCO_STATUS" jdbcType="VARCHAR" property="inscoStatus" />
    <result column="INSCO_FEEDBACK" jdbcType="VARCHAR" property="inscoFeedback" />
    <result column="POLICYNO" jdbcType="VARCHAR" property="policyno" />
    <result column="FILENAME_CTF" jdbcType="VARCHAR" property="filenameCtf" />
  </resultMap>
  
  <resultMap class="com.tlg.aps.vo.Aps002DetailVo" id="aps002DetailVoResultMap">
    <result column="BATCH_NO" jdbcType="VARCHAR" property="batchNo" />
    <result column="BATCH_SEQ" jdbcType="VARCHAR" property="batchSeq" />
    <result column="FK_ORDER_SEQ" jdbcType="VARCHAR" property="fkOrderSeq" />
    <result column="ORDER_SEQ_STATUS" jdbcType="VARCHAR" property="orderSeqStatus" />
    <result column="FK_STATUS" jdbcType="VARCHAR" property="fkStatus" />
    <result column="DQUAKE_STATUS" jdbcType="VARCHAR" property="dquakeStatus" />
    <result column="DQUAKE_NO" jdbcType="VARCHAR" property="dquakeNo" />
    <result column="OID_FIR_PREMCALC_TMP" jdbcType="DECIMAL" property="oidFirPremcalcTmp" />
    <result column="FAMT_STATUS" jdbcType="VARCHAR" property="famtStatus" />
    <result column="WS_FIR_AMT" jdbcType="DECIMAL" property="wsFirAmt" />
    <result column="QAMT_STATUS" jdbcType="VARCHAR" property="qamtStatus" />
    <result column="WS_QUAKE_AMT" jdbcType="DECIMAL" property="wsQuakeAmt" />
    <result column="ADDR_STATUS" jdbcType="VARCHAR" property="addrStatus" />
    <result column="ADDR_DETAIL" jdbcType="VARCHAR" property="addrDetail" />
    <result column="IS_TIFF" jdbcType="VARCHAR" property="isTiff" />
    <result column="FILENAME_TIFF" jdbcType="VARCHAR" property="filenameTiff" />
    <result column="CHECK_ERR_MSG" jdbcType="VARCHAR" property="checkErrMsg" />
    <result column="CHECK_WARN_MSG" jdbcType="VARCHAR" property="checkWarnMsg" />
    <result column="TRANS_TMP_TIME" jdbcType="TIMESTAMP" property="transTmpTime" />
    <result column="TRANS_PPS_TIME" jdbcType="TIMESTAMP" property="transPpsTime" />
    <result column="PRINT_CTF_TIME" jdbcType="TIMESTAMP" property="printCtfTime" />
    <result column="POLICYNO" jdbcType="VARCHAR" property="policyno" />
    <result column="CORE_CANCEL_USER" jdbcType="VARCHAR" property="coreCancelUser" />
    <result column="CORE_CANCEL_TIME" jdbcType="TIMESTAMP" property="coreCancelTime" />
    <result column="BK_TIME" jdbcType="TIMESTAMP" property="bkTime" />
    <result column="BK_FILENAME" jdbcType="VARCHAR" property="bkFilename" />
    <result column="BK_TYPE" jdbcType="VARCHAR" property="bkType" />
    <result column="DELETE_FLAG" jdbcType="VARCHAR" property="deleteFlag" />
    <result column="ICREATE" jdbcType="VARCHAR" property="icreate" />
    <result column="DCREATE" jdbcType="TIMESTAMP" property="dcreate" />
    <result column="IUPDATE" jdbcType="VARCHAR" property="iupdate" />
    <result column="DUPDATE" jdbcType="TIMESTAMP" property="dupdate" />
    
    <result column="PROPOSALNO" jdbcType="VARCHAR" property="proposalno" />
    <result column="CTF_OID" jdbcType="VARCHAR" property="ctfOid" />
    <result column="SEND_TYPE" jdbcType="VARCHAR" property="sendType" />
    <result column="COMM_CENTER_CODE" jdbcType="VARCHAR" property="commCenterCode" />
    <!-- mantis：FIR0181， 中信新件流程-排程查詢作業(含產生查詢及回饋查詢) -->
    <result column="CORE_COMCODE" jdbcType="VARCHAR" property="coreComcode" />
    
    <result column="PRPINS_BATCH_NO" jdbcType="VARCHAR" property="prpinsBatchNo" />
    <result column="PRPINS_BATCH_STATUS" jdbcType="VARCHAR" property="prpinsBatchStatus" />
    <result column="PRPINS_BATCH_ERRMSG" jdbcType="VARCHAR" property="prpinsBatchErrmsg" />
    <result column="SP_BATCH_NO" jdbcType="VARCHAR" property="spBatchNo" />

	<!-- mantis：FIR0181， 中信新件流程-排程查詢作業(含產生查詢及回饋查詢) start-->
	<result column="APPLINAME" jdbcType="VARCHAR" property="appliname" />
	<result column="INSUREDNAME" jdbcType="VARCHAR" property="insuredname" />
	<result column="HANDLER1CODE" jdbcType="VARCHAR" property="handler1code" />
	<result column="COMCODE" jdbcType="VARCHAR" property="comcode" />
	<result column="HANDLERIDENTIFYNUMBER" jdbcType="VARCHAR" property="handleridentifynumber" />
	<result column="HANDLERNAME" jdbcType="VARCHAR" property="handlername" />
	<!-- mantis：FIR0181， 中信新件流程-排程查詢作業(含產生查詢及回饋查詢) end -->
  </resultMap>
  
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 19 17:18:25 CST 2020.
    -->
    BATCH_NO, BATCH_SEQ, FK_ORDER_SEQ, ORDER_SEQ_STATUS, FK_STATUS, DQUAKE_STATUS, DQUAKE_NO, 
    OID_FIR_PREMCALC_TMP, FAMT_STATUS, WS_FIR_AMT, QAMT_STATUS, WS_QUAKE_AMT, ADDR_STATUS, 
    ADDR_DETAIL, IS_TIFF, FILENAME_TIFF, CHECK_ERR_MSG, CHECK_WARN_MSG, TRANS_TMP_TIME, 
    TRANS_PPS_TIME, PRINT_CTF_TIME, POLICYNO, CORE_CANCEL_USER, CORE_CANCEL_TIME, BK_TIME, 
    BK_FILENAME, BK_TYPE, DELETE_FLAG, ICREATE, DCREATE, IUPDATE, DUPDATE
  </sql>
  
  <select id="count" parameterClass="java.util.Map" resultClass="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 19 17:18:25 CST 2020.
    -->
    select count(1) from <include refid="Utils.prpinsSchema"/>FIR_CTBC_BATCH_DTL
    	<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				BATCH_NO = #batchNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="batchSeq">
				BATCH_SEQ = #batchSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fkOrderSeq">
				FK_ORDER_SEQ = #fkOrderSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeq">
				FK_ORDER_SEQ = #orderSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="policyno">
				POLICYNO = #policyno#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="deleteFlag">
				DELETE_FLAG = #deleteFlag#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="deleteFlagNotEqual">
				DELETE_FLAG <![CDATA[<>]]> #deleteFlagNotEqual#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeqStatusList">
				ORDER_SEQ_STATUS in 
  				<iterate property="orderSeqStatusList" conjunction="," open="(" close=")" >
	          		#orderSeqStatusList[]#
      			</iterate>
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="startCreateDate">
				DCREATE <![CDATA[>=]]> to_date(#startCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="endCreateDate">
				DCREATE <![CDATA[<=]]> to_date(#endCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
			</isNotEmpty>
    </dynamic>
  </select>
  
  <select id="countJoinStl" parameterClass="java.util.Map" resultClass="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 19 17:18:25 CST 2020.
    -->
    <!-- mantis：FIR0708，處理人員：DP0714，住火_APS_中信新件轉入查詢作業增加多個單位邏輯 start -->
    select count(DTL.FK_ORDER_SEQ)
      from FIR_CTBC_BATCH_DTL DTL
      LEFT JOIN FIR_CTBC_STL STL ON DTL.BATCH_NO = STL.BATCH_NO AND DTL.BATCH_SEQ = STL.BATCH_SEQ AND DTL.FK_ORDER_SEQ = STL.FK_ORDER_SEQ
      LEFT JOIN PRPTMAIN PM ON DTL.FK_ORDER_SEQ = PM.ORDERSEQ
    <!-- mantis：FIR0708，處理人員：DP0714，住火_APS_中信新件轉入查詢作業增加多個單位邏輯 end -->
    	<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="batchSeq">
				DTL.BATCH_SEQ = #batchSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fkOrderSeq">
				DTL.FK_ORDER_SEQ = #fkOrderSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeq">
				DTL.FK_ORDER_SEQ = #orderSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="policyno">
				DTL.POLICYNO = #policyno#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="deleteFlag">
				DTL.DELETE_FLAG = #deleteFlag#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fkStatus">
				DTL.FK_STATUS = #fkStatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="deleteFlagNotEqual">
				DTL.DELETE_FLAG <![CDATA[<>]]> #deleteFlagNotEqual#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeqStatus">
				DTL.ORDER_SEQ_STATUS = #orderSeqStatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeqStatusList">
				DTL.ORDER_SEQ_STATUS in 
  				<iterate property="orderSeqStatusList" conjunction="," open="(" close=")" >
	          		#orderSeqStatusList[]#
      			</iterate>
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="startCreateDate">
				DTL.DCREATE <![CDATA[>=]]> to_date(#startCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="endCreateDate">
				DTL.DCREATE <![CDATA[<=]]> to_date(#endCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
			</isNotEmpty>
			
			<isNotEmpty prepend="AND" property="sendType">
				STL.SEND_TYPE = #sendType#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="coreHandler1code">
				STL.CORE_HANDLER1CODE = #coreHandler1code#
			</isNotEmpty>
			<!-- mantis：FIR0708，處理人員：DP0714，住火_APS_中信新件轉入查詢作業增加多個單位邏輯 start -->
			<isNotEmpty prepend="AND" property="coreComcodeList">
				PM.COMCODE in 
  				<iterate property="coreComcodeList" conjunction="," open="(" close=")" >
	          		#coreComcodeList[]#
      			</iterate>
			</isNotEmpty>
			<!-- mantis：FIR0708，處理人員：DP0714，住火_APS_中信新件轉入查詢作業增加多個單位邏輯 end -->
    </dynamic>
  </select>
  
  <select id="selectByParams" parameterClass="java.util.Map" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 19 17:18:25 CST 2020.
    -->
    select * from <include refid="Utils.prpinsSchema"/>FIR_CTBC_BATCH_DTL
    	<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				BATCH_NO = #batchNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="batchSeq">
				BATCH_SEQ = #batchSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fkOrderSeq">
				FK_ORDER_SEQ = #fkOrderSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeq">
				FK_ORDER_SEQ = #orderSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="policyno">
				POLICYNO = #policyno#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="deleteFlag">
				DELETE_FLAG = #deleteFlag#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="deleteFlagNotEqual">
				DELETE_FLAG <![CDATA[<>]]> #deleteFlagNotEqual#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeqStatusList">
				ORDER_SEQ_STATUS in 
  				<iterate property="orderSeqStatusList" conjunction="," open="(" close=")" >
	          		#orderSeqStatusList[]#
      			</iterate>
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="startCreateDate">
				DCREATE <![CDATA[>=]]> to_date(#startCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="endCreateDate">
				DCREATE <![CDATA[<=]]> to_date(#endCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
			</isNotEmpty>
    </dynamic>
  </select>
  
  <select id="select" parameterClass="java.util.Map" resultMap="BaseResultMap">
  	<include refid="Utils.sql1"/>
	 select 
    <include refid="FirCtbcBatchDtl.Base_Column_List" />
    from <include refid="Utils.prpinsSchema"/>FIR_CTBC_BATCH_DTL
    <dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				BATCH_NO = #batchNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="batchSeq">
				BATCH_SEQ = #batchSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fkOrderSeq">
				FK_ORDER_SEQ = #fkOrderSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeq">
				FK_ORDER_SEQ = #orderSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="policyno">
				POLICYNO = #policyno#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="deleteFlag">
				DELETE_FLAG = #deleteFlag#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="deleteFlagNotEqual">
				DELETE_FLAG <![CDATA[<>]]> #deleteFlagNotEqual#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeqStatusList">
				ORDER_SEQ_STATUS in 
  				<iterate property="orderSeqStatusList" conjunction="," open="(" close=")" >
	          		#orderSeqStatusList[]#
      			</iterate>
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="startCreateDate">
				DCREATE <![CDATA[>=]]> to_date(#startCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="endCreateDate">
				DCREATE <![CDATA[<=]]> to_date(#endCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
			</isNotEmpty>
    </dynamic>
    <isNotEmpty property="sotrBy">
		ORDER BY $sortBy$ $sortType$ 
	</isNotEmpty>
    <include refid="Utils.sql2"/>
  </select>
  
  <!-- mantis：FIR0181， 中信新件流程-排程查詢作業(含產生查詢及回饋查詢) -->
  <select id="selectJoinStl" parameterClass="java.util.Map" resultMap="aps002DetailVoResultMap">
  	<include refid="Utils.sql1"/>
    <!-- mantis：FIR0708，處理人員：DP0714，住火_APS_中信新件轉入查詢作業增加多個單位邏輯 start -->
    select DTL.*, STL.SEND_TYPE, STL.COMM_CENTER_CODE, PM.COMCODE AS CORE_COMCODE , '' AS PROPOSALNO, '' AS CTF_OID,
	 '' AS COMCODE, '' AS HANDLER1CODE, '' AS APPLINAME, '' AS INSUREDNAME, '' AS HANDLERIDENTIFYNUMBER, '' AS HANDLERNAME
      from FIR_CTBC_BATCH_DTL DTL
      LEFT JOIN FIR_CTBC_STL STL ON DTL.BATCH_NO = STL.BATCH_NO AND DTL.BATCH_SEQ = STL.BATCH_SEQ AND DTL.FK_ORDER_SEQ = STL.FK_ORDER_SEQ
      LEFT JOIN PRPTMAIN PM ON DTL.FK_ORDER_SEQ = PM.ORDERSEQ
    <!-- mantis：FIR0708，處理人員：DP0714，住火_APS_中信新件轉入查詢作業增加多個單位邏輯 end -->
    <dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="batchSeq">
				DTL.BATCH_SEQ = #batchSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fkOrderSeq">
				DTL.FK_ORDER_SEQ = #fkOrderSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeq">
				DTL.FK_ORDER_SEQ = #orderSeq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="policyno">
				DTL.POLICYNO = #policyno#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="deleteFlag">
				DTL.DELETE_FLAG = #deleteFlag#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fkStatus">
				DTL.FK_STATUS = #fkStatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="deleteFlagNotEqual">
				DTL.DELETE_FLAG <![CDATA[<>]]> #deleteFlagNotEqual#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeqStatus">
				DTL.ORDER_SEQ_STATUS = #orderSeqStatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderSeqStatusList">
				DTL.ORDER_SEQ_STATUS in 
  				<iterate property="orderSeqStatusList" conjunction="," open="(" close=")" >
	          		#orderSeqStatusList[]#
      			</iterate>
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="startCreateDate">
				DTL.DCREATE <![CDATA[>=]]> to_date(#startCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="endCreateDate">
				DTL.DCREATE <![CDATA[<=]]> to_date(#endCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
			</isNotEmpty>
			
			<isNotEmpty prepend="AND" property="sendType">
				STL.SEND_TYPE = #sendType#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="coreHandler1code">
				STL.CORE_HANDLER1CODE = #coreHandler1code#
			</isNotEmpty>
			<!-- mantis：FIR0708，處理人員：DP0714，住火_APS_中信新件轉入查詢作業增加多個單位邏輯 start -->
			<isNotEmpty prepend="AND" property="coreComcodeList">
				PM.COMCODE in 
  				<iterate property="coreComcodeList" conjunction="," open="(" close=")" >
	          		#coreComcodeList[]#
      			</iterate>
			</isNotEmpty>
			<!-- mantis：FIR0708，處理人員：DP0714，住火_APS_中信新件轉入查詢作業增加多個單位邏輯 end -->
    </dynamic>
    <isNotEmpty property="sotrBy">
		ORDER BY $sortBy$ $sortType$ 
	</isNotEmpty>
    <include refid="Utils.sql2"/>
  </select>
  
  <select id="selectByPrimaryKey" parameterClass="com.tlg.prpins.entity.FirCtbcBatchDtl" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 19 17:18:25 CST 2020.
    -->
    select 
    <include refid="FirCtbcBatchDtl.Base_Column_List" />
    from FIR_CTBC_BATCH_DTL
    where BATCH_NO = #batchNo:VARCHAR#
      and BATCH_SEQ = #batchSeq:VARCHAR#
      and FK_ORDER_SEQ = #fkOrderSeq:VARCHAR#
  </select>
  <select id="selectForFeedback"  parameterClass="java.util.Map" resultMap="firCtbcRstResultMap" >
    SELECT '1' AS RST_TYPE, FDT1.FK_ORDER_SEQ, '02' AS INSCO_STATUS, 
		FDT1.CHECK_ERR_MSG AS INSCO_FEEDBACK, NULL AS POLICYNO, NULL AS FILENAME_CTF, 
		FDT1.BATCH_NO, FDT1.BATCH_SEQ
	FROM FIR_CTBC_BATCH_DTL FDT1
	WHERE FDT1.DELETE_FLAG = 'N' AND FDT1.ORDER_SEQ_STATUS = '1' 
	UNION ALL
	SELECT '2' AS RST_TYPE, FDT2.FK_ORDER_SEQ, '02' AS INSCO_STATUS,
		FC.REMARK AS INSCO_FEEDBACK, NULL AS POLICYNO, NULL AS FILENAME_CTF, 
		FDT2.BATCH_NO, FDT2.BATCH_SEQ
	FROM FIR_CTBC_BATCH_DTL FDT2
	INNER JOIN FIR_PRPT_CANCEL FC ON FDT2.FK_ORDER_SEQ = FC.ORDERSEQ
	WHERE FDT2.DELETE_FLAG = 'N' AND FDT2.ORDER_SEQ_STATUS = '5'
	UNION ALL
	SELECT '3' AS RST_TYPE, FDT3.FK_ORDER_SEQ, '01' AS INSCO_STATUS, 
		CASE WHEN FDT3.DQUAKE_STATUS = 'D' THEN to_nchar('複保險') ELSE NULL END AS INSCO_FEEDBACK,
		FDT3.POLICYNO, TRIM(FDT3.FK_ORDER_SEQ) || '.pdf' AS FILENAME_CTF, 
		FDT3.BATCH_NO, FDT3.BATCH_SEQ
	FROM FIR_CTBC_BATCH_DTL FDT3
	WHERE FDT3.DELETE_FLAG = 'N' AND FDT3.ORDER_SEQ_STATUS = 'A' 
		AND FDT3.SP_BATCH_NO = #batchNo# AND FDT3.POLICYNO IS NOT NULL
	UNION ALL
	SELECT '4' AS RST_TYPE, FK_ORDER_SEQ, '01' AS INSCO_STATUS, 
		CASE WHEN DQUAKE_STATUS = 'D' THEN to_nchar('複保險') ELSE NULL END AS INSCO_FEEDBACK,
		POLICYNO, NULL AS FILENAME_CTF, BATCH_NO, BATCH_SEQ
		FROM FIR_CTBC_BATCH_DTL
		WHERE DELETE_FLAG = 'N' AND ORDER_SEQ_STATUS = 'J' 
		AND SP_BATCH_NO = #batchNo# AND POLICYNO IS NOT NULL
	<!-- mantis：FIR0497，處理人員：BJ085，需求單編號：FIR0497 中信保代網投_新件回饋檔產生排程規格_新增保經代網投 start -->
	UNION ALL
    SELECT '5' AS RST_TYPE, FK_ORDER_SEQ, '01' AS INSCO_STATUS, 
    NULL AS INSCO_FEEDBACK, POLICYNO, TRIM(FK_ORDER_SEQ) || '.pdf' AS FILENAME_CTF, 
    BATCH_NO, BATCH_SEQ
    FROM FIR_CTBC_B2B2C
    WHERE ORDER_SEQ_STATUS = 'A' AND SP_BATCH_NO = #batchNo#
	<!-- mantis：FIR0497，處理人員：BJ085，需求單編號：FIR0497 中信保代網投_新件回饋檔產生排程規格_新增保經代網投 end -->
	<!-- mantis：FIR0497，處理人員：BJ085，需求單編號：FIR0497 中信保代網投_新件回饋檔產生排程規格_新增保經代網投_付款失敗產生回饋檔 start -->
	UNION ALL
	SELECT '5' AS RST_TYPE, FK_ORDER_SEQ, '02' AS INSCO_STATUS,
	CASE DEBIT_TYPE 
	    WHEN '1' THEN to_nchar('本行帳號扣款失敗')
	    WHEN '2' THEN to_nchar('本行信用卡扣款失敗')
	    ELSE to_nchar('付款失敗')
	END AS INSCO_FEEDBACK, NULL AS POLICYNO, NULL AS FILENAME_CTF,
	BATCH_NO, BATCH_SEQ
	FROM FIR_CTBC_B2B2C
	WHERE ORDER_SEQ_STATUS = '2'
    <!-- mantis：FIR0497，處理人員：BJ085，需求單編號：FIR0497 中信保代網投_新件回饋檔產生排程規格_付款失敗產生回饋檔 end -->
  </select>
  
  <!-- mantis：FIR0181， 中信新件流程-排程查詢作業(含產生查詢及回饋查詢) -->
  <select id="selectForAps002Detail"  parameterClass="java.util.Map" resultMap="aps002DetailVoResultMap" >
    SELECT DTL.*, CTF.PROPOSALNO, CTF.OID AS CTF_OID, STL.SEND_TYPE, STL.COMM_CENTER_CODE, STL.CORE_COMCODE,
    	PM.COMCODE, PM.HANDLER1CODE, PM.APPLINAME, PM.INSUREDNAME, PM.HANDLERIDENTIFYNUMBER, PM.HANDLERNAME
FROM FIR_CTBC_BATCH_DTL DTL
LEFT JOIN FIR_RPT_CTBC_CTF CTF ON DTL.BATCH_NO = CTF.DTL_BATCH_NO AND DTL.BATCH_SEQ = CTF.DTL_BATCH_SEQ AND DTL.FK_ORDER_SEQ = CTF.ORDERSEQ AND DTL.SP_BATCH_NO = CTF.RST_BATCH_NO
LEFT JOIN FIR_CTBC_STL STL ON DTL.BATCH_NO = STL.BATCH_NO AND DTL.BATCH_SEQ = STL.BATCH_SEQ AND DTL.FK_ORDER_SEQ = STL.FK_ORDER_SEQ
LEFT JOIN PRPTMAIN PM ON DTL.FK_ORDER_SEQ = PM.ORDERSEQ
WHERE 1=1
	<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="batchSeq">
				DTL.BATCH_SEQ = #batchSeq#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="fkOrderSeq">
				DTL.FK_ORDER_SEQ = #fkOrderSeq#
	</isNotEmpty>

  </select>
  
  <delete id="delete" parameterClass="com.tlg.prpins.entity.FirCtbcBatchDtl">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 19 17:18:25 CST 2020.
    -->
    delete from FIR_CTBC_BATCH_DTL
    where BATCH_NO = #batchNo:VARCHAR#
      and BATCH_SEQ = #batchSeq:VARCHAR#
      and FK_ORDER_SEQ = #fkOrderSeq:VARCHAR#
  </delete>

  <insert id="insert" parameterClass="com.tlg.prpins.entity.FirCtbcBatchDtl">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 19 17:18:25 CST 2020.
    -->
    insert into FIR_CTBC_BATCH_DTL (BATCH_NO, BATCH_SEQ, FK_ORDER_SEQ, ORDER_SEQ_STATUS, 
      FK_STATUS, DQUAKE_STATUS, DQUAKE_NO, OID_FIR_PREMCALC_TMP, 
      FAMT_STATUS, WS_FIR_AMT, QAMT_STATUS, WS_QUAKE_AMT, 
      ADDR_STATUS, ADDR_DETAIL, IS_TIFF, FILENAME_TIFF, 
      CHECK_ERR_MSG, CHECK_WARN_MSG, TRANS_TMP_TIME, TRANS_PPS_TIME, 
      PRINT_CTF_TIME, POLICYNO, CORE_CANCEL_USER, CORE_CANCEL_TIME, 
      BK_TIME, BK_FILENAME, BK_TYPE, DELETE_FLAG, 
      ICREATE, DCREATE, IUPDATE, DUPDATE)
    values (#batchNo:VARCHAR#, #batchSeq:VARCHAR#, #fkOrderSeq:VARCHAR#, #orderSeqStatus:VARCHAR#, 
      #fkStatus:VARCHAR#, #dquakeStatus:VARCHAR#, #dquakeNo:VARCHAR#, #oidFirPremcalcTmp:DECIMAL#, 
      #famtStatus:VARCHAR#, #wsFirAmt:DECIMAL#, #qamtStatus:VARCHAR#, #wsQuakeAmt:DECIMAL#, 
      #addrStatus:VARCHAR#, #addrDetail:VARCHAR#, #isTiff:VARCHAR#, #filenameTiff:VARCHAR#, 
      #checkErrMsg:VARCHAR#, #checkWarnMsg:VARCHAR#, #transTmpTime:TIMESTAMP#, #transPpsTime:TIMESTAMP#, 
      #printCtfTime:TIMESTAMP#, #policyno:VARCHAR#, #coreCancelUser:VARCHAR#, #coreCancelTime:TIMESTAMP#, 
      #bkTime:TIMESTAMP#, #bkFilename:VARCHAR#, #bkType:VARCHAR#, #deleteFlag:VARCHAR#, 
      #icreate:VARCHAR#, #dcreate:TIMESTAMP#, #iupdate:VARCHAR#, #dupdate:TIMESTAMP#)
  </insert>
  
  <update id="update" parameterClass="com.tlg.prpins.entity.FirCtbcBatchDtl">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 19 17:18:25 CST 2020.
    -->
    update FIR_CTBC_BATCH_DTL
    <dynamic prepend="set">
      <isNotNull prepend="," property="orderSeqStatus">
        ORDER_SEQ_STATUS = #orderSeqStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fkStatus">
        FK_STATUS = #fkStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dquakeStatus">
        DQUAKE_STATUS = #dquakeStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dquakeNo">
        DQUAKE_NO = #dquakeNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="oidFirPremcalcTmp">
        OID_FIR_PREMCALC_TMP = #oidFirPremcalcTmp:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="famtStatus">
        FAMT_STATUS = #famtStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="wsFirAmt">
        WS_FIR_AMT = #wsFirAmt:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="qamtStatus">
        QAMT_STATUS = #qamtStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="wsQuakeAmt">
        WS_QUAKE_AMT = #wsQuakeAmt:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="addrStatus">
        ADDR_STATUS = #addrStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="addrDetail">
        ADDR_DETAIL = #addrDetail:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="isTiff">
        IS_TIFF = #isTiff:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="filenameTiff">
        FILENAME_TIFF = #filenameTiff:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="checkErrMsg">
        CHECK_ERR_MSG = #checkErrMsg:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="checkWarnMsg">
        CHECK_WARN_MSG = #checkWarnMsg:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="transTmpTime">
        TRANS_TMP_TIME = #transTmpTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="transPpsTime">
        TRANS_PPS_TIME = #transPpsTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="printCtfTime">
        PRINT_CTF_TIME = #printCtfTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="policyno">
        POLICYNO = #policyno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="coreCancelUser">
        CORE_CANCEL_USER = #coreCancelUser:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="coreCancelTime">
        CORE_CANCEL_TIME = #coreCancelTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="bkTime">
        BK_TIME = #bkTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="bkFilename">
        BK_FILENAME = #bkFilename:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="bkType">
        BK_TYPE = #bkType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deleteFlag">
        DELETE_FLAG = #deleteFlag:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="icreate">
        ICREATE = #icreate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dcreate">
        DCREATE = #dcreate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="iupdate">
        IUPDATE = #iupdate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dupdate">
        DUPDATE = #dupdate:TIMESTAMP#
      </isNotNull>
      <!-- mantis：FIR0181， 中信新件流程-排程查詢作業(含產生查詢及回饋查詢) start-->
      <isNotNull prepend="," property="prpinsBatchStatus">
        PRPINS_BATCH_STATUS = #prpinsBatchStatus:VARCHAR#
      </isNotNull>
      <!-- mantis：FIR0181， 中信新件流程-排程查詢作業(含產生查詢及回饋查詢) end-->
    </dynamic>
    where BATCH_NO = #batchNo:VARCHAR#
      and BATCH_SEQ = #batchSeq:VARCHAR#
      and FK_ORDER_SEQ = #fkOrderSeq:VARCHAR#
  </update>
 
</sqlMap>