<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="HandlercodeTmp" >
  <resultMap id="BaseResultMap" class="com.tlg.sales.entity.HandlercodeTmp" >
    <result column="HANDLERCODE" property="handlercode" jdbcType="VARCHAR" />
    <result column="ORGICODE" property="orgicode" jdbcType="VARCHAR" />
    <result column="HANDLERNAME" property="handlername" jdbcType="OTHER" />
    <result column="AMT" property="amt" jdbcType="DECIMAL" />
    <result column="VALIDSTATUS" property="validstatus" jdbcType="VARCHAR" />
    <result column="ICREATE" property="icreate" jdbcType="OTHER" />
    <result column="DCREATE" property="dcreate" jdbcType="TIMESTAMP" />
  </resultMap>
  
  <resultMap id="mapVaild" class="java.util.HashMap" >
    <result column="HANDLERCODE" property="handlercode" jdbcType="VARCHAR" />
    <result column="ORGICODE" property="orgicode" jdbcType="VARCHAR" />
    <result column="CMEM18" property="cmem18" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="selectByParams" resultMap="BaseResultMap" parameterClass="java.util.Map">
	SELECT * FROM <include refid="Utils.salesSchema"/>HANDLERCODE_TMP
	<dynamic prepend="WHERE">
		<isNotEmpty prepend="AND" property="handlercode">
			HANDLERCODE = #handlercode#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="orgicode">
			ORGICODE = #orgicode#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="validstatus">
			VALIDSTATUS = #validstatus#
		</isNotEmpty>
	</dynamic>
  </select>
  
  <select id="selectHandlercodeIsValid" resultMap="mapVaild" parameterClass="java.util.Map">
	SELECT A.HANDLERCODE, B.CMEM18, A.ORGICODE FROM <include refid="Utils.salesSchema"/>HANDLERCODE_TMP A 
	LEFT JOIN COMMDATA_CMEMFIL B 
	ON A.HANDLERCODE=B.CMEM00 
	<dynamic prepend="WHERE">
		<isNotEmpty prepend="AND" property="orgicode">
			A.ORGICODE = #orgicode#
		</isNotEmpty>
		<!-- mantis：SALES0014，處理人員：CC009，需求單編號：SALES0014 銷管系統-APS-所屬服務人員維護新增批次上下傳功能 start -->
		<isNotEmpty prepend="AND" property="orgicodeIsNull">
			(A.ORGICODE is null or A.ORGICODE = '')
		</isNotEmpty>
		<!-- mantis：SALES0014，處理人員：CC009，需求單編號：SALES0014 銷管系統-APS-所屬服務人員維護新增批次上下傳功能 end -->
		<isNotEmpty prepend="AND" property="cmem00">
			B.CMEM00 = #cmem00#
		</isNotEmpty>
		<isNull prepend="AND" property="cmem00">
			B.CMEM00 IS NULL
		</isNull>
		<isNotEmpty prepend="AND" property="validstatus">
			A.VALIDSTATUS = #validstatus#
		</isNotEmpty>
	</dynamic>
  </select>
  
  <delete id="delete" parameterClass="com.tlg.sales.entity.HandlercodeTmp" >
    delete from <include refid="Utils.salesSchema"/>HANDLERCODE_TMP
    	where HANDLERCODE = #handlercode:VARCHAR#
  		and ORGICODE = #orgicode:VARCHAR#
  </delete>
  
  <insert id="insert" parameterClass="com.tlg.sales.entity.HandlercodeTmp" >
    insert into <include refid="Utils.salesSchema"/>HANDLERCODE_TMP 
    	(HANDLERCODE, ORGICODE, HANDLERNAME, AMT, VALIDSTATUS, ICREATE, DCREATE)
    	values (#handlercode:VARCHAR#, #orgicode:VARCHAR#, #handlername:OTHER#, #amt:DECIMAL#,
      	#validstatus:VARCHAR#, #icreate:OTHER#, #dcreate:TIMESTAMP#)
  </insert>
  
  <update id="update" parameterClass="com.tlg.sales.entity.HandlercodeTmp" >
    update <include refid="Utils.salesSchema"/>HANDLERCODE_TMP
    <dynamic prepend="set" >
      <isNotNull prepend="," property="handlername" >
        HANDLERNAME = #handlername:OTHER#
      </isNotNull>
      <isNotNull prepend="," property="amt" >
        AMT = #amt:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="validstatus" >
        VALIDSTATUS = #validstatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="icreate" >
        ICREATE = #icreate:OTHER#
      </isNotNull>
      <isNotNull prepend="," property="dcreate" >
        DCREATE = #dcreate:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where HANDLERCODE = #handlercode:VARCHAR#
      and ORGICODE = #orgicode:VARCHAR#
  </update>
</sqlMap>