<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<!-- mantis：FIR0294，處理人員：BJ085，需求單編號：FIR0294 外銀板信續件移回新核心-資料接收排程 start -->
<sqlMap namespace="PrpdAgreement">
  <resultMap class="com.tlg.sales.entity.PrpdAgreement" id="BaseResultMap">
    <result column="AGREEMENTNO" jdbcType="VARCHAR" property="agreementno" />
    <result column="AGENTCODE" jdbcType="VARCHAR" property="agentcode" />
    <result column="SIGNDATE" jdbcType="TIMESTAMP" property="signdate" />
    <result column="STARTDATE" jdbcType="TIMESTAMP" property="startdate" />
    <result column="ENDDATE" jdbcType="TIMESTAMP" property="enddate" />
    <result column="SETTLECYCLE" jdbcType="DECIMAL" property="settlecycle" />
    <result column="VALIDSTATUS" jdbcType="VARCHAR" property="validstatus" />
    <result column="FLAG" jdbcType="CHAR" property="flag" />
    <result column="COMCODE" jdbcType="VARCHAR" property="comcode" />
    <result column="LOWERVIEWFLAG" jdbcType="VARCHAR" property="lowerviewflag" />
    <result column="CREATERCODE" jdbcType="VARCHAR" property="creatercode" />
    <result column="CREATETIME" jdbcType="VARCHAR" property="createtime" />
    <result column="UPDATERCODE" jdbcType="VARCHAR" property="updatercode" />
    <result column="UPDATEDATE" jdbcType="VARCHAR" property="updatedate" />
    <result column="SETTLEDAY" jdbcType="DECIMAL" property="settleday" />
    <result column="OVERDUEDAYCOUNT" jdbcType="DECIMAL" property="overduedaycount" />
    <result column="OVERDUEDAYCOUNTSET" jdbcType="DECIMAL" property="overduedaycountset" />
    <result column="MAXOVERDUERATE" jdbcType="DECIMAL" property="maxoverduerate" />
    <result column="MAXOVERDUERATESET" jdbcType="DECIMAL" property="maxoverduerateset" />
    <result column="MAXOVERDUECYCLE" jdbcType="DECIMAL" property="maxoverduecycle" />
    <result column="MAXOVERDUECYCLESET" jdbcType="DECIMAL" property="maxoverduecycleset" />
    <result column="MAXOVERDUECOUNT" jdbcType="DECIMAL" property="maxoverduecount" />
    <result column="MAXOVERDUECOUNTSET" jdbcType="DECIMAL" property="maxoverduecountset" />
    <result column="MAXOVERDUEFEE" jdbcType="DECIMAL" property="maxoverduefee" />
    <result column="MAXOVERDUEFEESET" jdbcType="DECIMAL" property="maxoverduefeeset" />
    <result column="OVERDUERATE" jdbcType="DECIMAL" property="overduerate" />
    <result column="CHECKORDER" jdbcType="VARCHAR" property="checkorder" />
    <result column="AGREEMENTNAME" jdbcType="VARCHAR" property="agreementname" />
    <result column="PROJECTCODE" jdbcType="VARCHAR" property="projectcode" />
    <result column="BUSINESSSOURCECODE" jdbcType="VARCHAR" property="businesssourcecode" />
    <result column="CHANNELTYPE" jdbcType="VARCHAR" property="channeltype" />
    <result column="ORGICODE" jdbcType="VARCHAR" property="orgicode" />
    <result column="SERVICEFEE" jdbcType="DECIMAL" property="servicefee" />
    <result column="CLASSCODE" jdbcType="VARCHAR" property="classcode" />
    <result column="SUITGOODSCODE" jdbcType="VARCHAR" property="suitgoodscode" />
    <result column="CLIENTUNITCODE" jdbcType="VARCHAR" property="clientunitcode" />
    <result column="CLIENTCODE" jdbcType="VARCHAR" property="clientcode" />
  </resultMap>
  
  <resultMap class="com.tlg.sales.entity.PrpdAgreement" id="joinDetailResultMap">
  	<result column="KINDCODE" jdbcType="VARCHAR" property="kindcode" />
    <result column="TOPCOMMISSION" jdbcType="VARCHAR" property="topCommission" />
  </resultMap>
  
  	<select id="select" resultMap="BaseResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
			SELECT * FROM <include refid="Utils.salesSchema"/>PRPDAGREEMENT
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="agreementno">
				AGREEMENTNO = #agreementno#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="agentcode">
				AGENTCODE = #agentcode#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="validstatus">
				VALIDSTATUS = #validstatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="comcode">
				COMCODE = #comcode#
			</isNotEmpty>
		</dynamic>
		<include refid="Utils.sql2" />
	</select>
	
	<select id="count" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*) FROM <include refid="Utils.salesSchema"/>PRPDAGREEMENT
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="agreementno">
				AGREEMENTNO = #agreementno#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="agentcode">
				AGENTCODE = #agentcode#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="validstatus">
				VALIDSTATUS = #validstatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="comcode">
				COMCODE = #comcode#
			</isNotEmpty>
		</dynamic>
	</select>
  
  <select id="selectByParams" resultMap="BaseResultMap" parameterClass="java.util.Map">
		SELECT * FROM <include refid="Utils.salesSchema"/>PRPDAGREEMENT
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="agreementno">
				AGREEMENTNO = #agreementno#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="agentcode">
				AGENTCODE = #agentcode#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="validstatus">
				VALIDSTATUS = #validstatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="comcode">
				COMCODE = #comcode#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- mantis：FIR0454，處理人員：BJ085，需求單編號：FIR0454 住火-APS富邦續件資料接收排程 -->
	<select id="selectCommissionJoinDetail" resultMap="joinDetailResultMap" parameterClass="java.util.Map">
		SELECT PAD.KINDCODE, PAD.TOPCOMMISSION FROM SALES.PRPDAGREEMENT PAM
		LEFT JOIN SALES.PRPDAGREEDETAIL PAD 
		ON PAM.AGENTCODE = PAD.AGENTCODE AND PAM.AGREEMENTNO = PAD.AGREEMENTNO
		WHERE PAM.CLASSCODE = 'F' AND PAD.KINDCODE IN ('FR2','FR3')
		AND PAM.VALIDSTATUS = '1' AND PAM.BUSINESSSOURCECODE = #businesssourcecode:VARCHAR#
	</select>
	
	<delete id="delete" parameterClass="com.tlg.sales.entity.PrpdAgreement" >
		delete from <include refid="Utils.salesSchema"/>PRPDAGREEMENT
		where AGREEMENTNO = #agreementno:VARCHAR#
	</delete>

  <insert id="insert" parameterClass="com.tlg.sales.entity.PrpdAgreement">
    insert into <include refid="Utils.salesSchema"/>PRPDAGREEMENT (AGREEMENTNO, AGENTCODE, SIGNDATE, STARTDATE, ENDDATE, SETTLECYCLE,
      VALIDSTATUS, FLAG, COMCODE, LOWERVIEWFLAG, CREATERCODE, CREATETIME, UPDATERCODE, UPDATEDATE,
      SETTLEDAY, OVERDUEDAYCOUNT, OVERDUEDAYCOUNTSET, MAXOVERDUERATE, MAXOVERDUERATESET,
      MAXOVERDUECYCLE, MAXOVERDUECYCLESET, MAXOVERDUECOUNT, MAXOVERDUECOUNTSET, MAXOVERDUEFEE,
      MAXOVERDUEFEESET, OVERDUERATE, CHECKORDER, AGREEMENTNAME, PROJECTCODE, BUSINESSSOURCECODE,
      CHANNELTYPE, ORGICODE, SERVICEFEE, CLASSCODE, SUITGOODSCODE, CLIENTUNITCODE, CLIENTCODE)
    values (#agreementno:VARCHAR#, #agentcode:VARCHAR#, #signdate:TIMESTAMP#, #startdate:TIMESTAMP#,
      #enddate:TIMESTAMP#, #settlecycle:DECIMAL#, #validstatus:VARCHAR#, #flag:CHAR#,
      #comcode:VARCHAR#, #lowerviewflag:VARCHAR#, #creatercode:VARCHAR#, #createtime:VARCHAR#,
      #updatercode:VARCHAR#, #updatedate:VARCHAR#, #settleday:DECIMAL#, #overduedaycount:DECIMAL#,
      #overduedaycountset:DECIMAL#, #maxoverduerate:DECIMAL#, #maxoverduerateset:DECIMAL#,
      #maxoverduecycle:DECIMAL#, #maxoverduecycleset:DECIMAL#, #maxoverduecount:DECIMAL#,
      #maxoverduecountset:DECIMAL#, #maxoverduefee:DECIMAL#, #maxoverduefeeset:DECIMAL#,
      #overduerate:DECIMAL#, #checkorder:VARCHAR#, #agreementname:VARCHAR#, #projectcode:VARCHAR#,
      #businesssourcecode:VARCHAR#, #channeltype:VARCHAR#, #orgicode:VARCHAR#, #servicefee:DECIMAL#,
      #classcode:VARCHAR#, #suitgoodscode:VARCHAR#, #clientunitcode:VARCHAR#, #clientcode:VARCHAR#)
  </insert>

  <update id="update" parameterClass="com.tlg.sales.entity.PrpdAgreement">
    update <include refid="Utils.salesSchema"/>PRPDAGREEMENT
    <dynamic prepend="set">
      <isNotNull prepend="," property="agentcode">
        AGENTCODE = #agentcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="signdate">
        SIGNDATE = #signdate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="startdate">
        STARTDATE = #startdate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="enddate">
        ENDDATE = #enddate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="settlecycle">
        SETTLECYCLE = #settlecycle:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="validstatus">
        VALIDSTATUS = #validstatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="flag">
        FLAG = #flag:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="comcode">
        COMCODE = #comcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="lowerviewflag">
        LOWERVIEWFLAG = #lowerviewflag:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="creatercode">
        CREATERCODE = #creatercode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createtime">
        CREATETIME = #createtime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="updatercode">
        UPDATERCODE = #updatercode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="updatedate">
        UPDATEDATE = #updatedate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="settleday">
        SETTLEDAY = #settleday:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="overduedaycount">
        OVERDUEDAYCOUNT = #overduedaycount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="overduedaycountset">
        OVERDUEDAYCOUNTSET = #overduedaycountset:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxoverduerate">
        MAXOVERDUERATE = #maxoverduerate:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxoverduerateset">
        MAXOVERDUERATESET = #maxoverduerateset:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxoverduecycle">
        MAXOVERDUECYCLE = #maxoverduecycle:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxoverduecycleset">
        MAXOVERDUECYCLESET = #maxoverduecycleset:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxoverduecount">
        MAXOVERDUECOUNT = #maxoverduecount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxoverduecountset">
        MAXOVERDUECOUNTSET = #maxoverduecountset:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxoverduefee">
        MAXOVERDUEFEE = #maxoverduefee:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxoverduefeeset">
        MAXOVERDUEFEESET = #maxoverduefeeset:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="overduerate">
        OVERDUERATE = #overduerate:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="checkorder">
        CHECKORDER = #checkorder:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="agreementname">
        AGREEMENTNAME = #agreementname:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="projectcode">
        PROJECTCODE = #projectcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="businesssourcecode">
        BUSINESSSOURCECODE = #businesssourcecode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="channeltype">
        CHANNELTYPE = #channeltype:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orgicode">
        ORGICODE = #orgicode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="servicefee">
        SERVICEFEE = #servicefee:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="classcode">
        CLASSCODE = #classcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="suitgoodscode">
        SUITGOODSCODE = #suitgoodscode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="clientunitcode">
        CLIENTUNITCODE = #clientunitcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="clientcode">
        CLIENTCODE = #clientcode:VARCHAR#
      </isNotNull>
    </dynamic>
    where AGREEMENTNO = #agreementno:VARCHAR#
  </update>
</sqlMap>