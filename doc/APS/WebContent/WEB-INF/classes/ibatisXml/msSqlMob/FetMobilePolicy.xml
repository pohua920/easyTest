<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="FetMobilePolicy">
	<resultMap class="com.tlg.msSqlMob.entity.FetMobilePolicy" id="BaseResultMap">
		<result column="transaction_id" property="transactionId" jdbcType="VARCHAR" />
		<result column="contract_id" property="contractId" jdbcType="VARCHAR" />
		<result column="application_id" property="applicationId" jdbcType="VARCHAR" />
		<result column="data_type" property="dataType" jdbcType="VARCHAR" />
		<result column="status" property="status" jdbcType="VARCHAR" />
		<result column="policy_no" property="policyNo" jdbcType="VARCHAR" />
		<result column="endorse_no" property="endorseNo" jdbcType="VARCHAR" />
		<result column="endorse_type" property="endorseType" jdbcType="VARCHAR" />
		<result column="endorse_text" property="endorseText" jdbcType="VARCHAR" />
		<result column="start_date" property="startDate" jdbcType="VARCHAR" />
		<result column="end_date" property="endDate" jdbcType="VARCHAR" />
		<result column="handler_identify_number" property="handlerIdentifyNumber" jdbcType="VARCHAR" />
		<result column="handler_name" property="handlerName" jdbcType="VARCHAR" />
		<result column="insured_code" property="insuredCode" jdbcType="VARCHAR" />
		<result column="insured_name" property="insuredName" jdbcType="VARCHAR" />
		<result column="head_name" property="headName" jdbcType="VARCHAR" />
		<result column="birthday" property="birthday" jdbcType="VARCHAR" />
		<result column="phone_tele_number" property="phoneTeleNumber" jdbcType="VARCHAR" />
		<result column="mobile" property="mobile" jdbcType="VARCHAR" />
		<result column="post_code" property="postCode" jdbcType="VARCHAR" />
		<result column="post_address" property="postAddress" jdbcType="VARCHAR" />
		<result column="insured_identity" property="insuredIdentity" jdbcType="VARCHAR" />
		<result column="country_ename" property="countryEname" jdbcType="VARCHAR" />
		<result column="domicile" property="domicile" jdbcType="VARCHAR" />
		<result column="email" property="email" jdbcType="VARCHAR" />
		<result column="branch_code" property="branchCode" jdbcType="VARCHAR" />
		<result column="branch_name" property="branchName" jdbcType="VARCHAR" />
		<result column="pay_no" property="payNo" jdbcType="VARCHAR" />
		<result column="plan_start_date" property="planStartDate" jdbcType="VARCHAR" />
		<result column="plan_end_date" property="planEndDate" jdbcType="VARCHAR" />
		<result column="created_by" property="createdBy" jdbcType="VARCHAR" />
		<result column="created_time" property="createdTime" jdbcType="TIMESTAMP" />
		<result column="modified_by" property="modifiedBy" jdbcType="VARCHAR" />
		<result column="modified_time" property="modifiedTime" jdbcType="TIMESTAMP" />
		<result column="endorse_date" jdbcType="VARCHAR" property="endorseDate" />
		<result column="core_fail_msg" jdbcType="VARCHAR" property="coreFailMsg" />
		<!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 START -->
    	<result column="data_src" jdbcType="VARCHAR" property="dataSrc" />
    	<result column="tx_id" jdbcType="VARCHAR" property="txId" />
    	<result column="ctbc_rcv_no" jdbcType="VARCHAR" property="ctbcRcvNo" />
    	<!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 END -->
	</resultMap>

	<resultMap class="com.tlg.msSqlMob.entity.FetMobilePolicy" id="policyNoMap">
		<result column="policy_no" property="policyNo" jdbcType="VARCHAR" />
	</resultMap>

	<select id="selectByWaitPolicy" parameterClass="java.util.Map" resultMap="policyNoMap">
	<!-- mantis：MOB0022，處理人員：CE035，需求單編號：MOB0022 匯入核心排程發信告知結果、修正手機險排程時間、修正保批單號資料型態、洗錢條件檢核補上批單號、遠傳資料批次下載使用者改ce035  --> 
		SELECT DISTINCT TOP 5000 POLICY_NO FROM FET_MOBILE_POLICY 
		WHERE STATUS = 'WAIT' 
		AND POLICY_NO NOT IN (SELECT POLICY_NO FROM FET_MOBILE_POLICY WHERE STATUS = 'HOLD' and (endorse_no = '' or endorse_no is null)) 
		ORDER BY POLICY_NO
	</select>
	
	<select id="countByWaitPolicy" parameterClass="java.util.Map" resultMap="BaseResultMap">
		SELECT COUNT(DISTINCT POLICY_NO) FROM FET_MOBILE_POLICY 
		WHERE STATUS = 'WAIT' 
		AND POLICY_NO NOT IN (SELECT POLICY_NO FROM FET_MOBILE_POLICY WHERE STATUS = 'HOLD' and (endorse_no = '' or endorse_no is null)) 
	</select>

	<select id="select" parameterClass="java.util.Map" resultMap="BaseResultMap">
		<include refid="Utils.msSql1" />
		select * from FET_MOBILE_POLICY
		<dynamic prepend="WHERE">
			<!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 START -->
	  		<isNotEmpty prepend="AND" property="dataSrc">
		      	data_src = #dataSrc:VARCHAR#
      		</isNotEmpty>
      		<isNotEmpty prepend="AND" property="txId">
		      	tx_id = #txId:VARCHAR#
	  		</isNotEmpty>
	  		<isNotEmpty prepend="AND" property="ctbcRcvNo">
				ctbc_rcv_no = #ctbcRcvNo#
			</isNotEmpty>
			<!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 END -->
			<isNotEmpty prepend="AND" property="transactionId">
				transaction_id = #transactionId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="contractId">
				contract_id = #contractId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="applicationId">
				application_id = #applicationId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="dataType">
				data_type = #dataType:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="status">
				status = #status:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="policyNo">
				policy_no = #policyNo:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="endorseNo">
			<!-- mantis：MOB0022，處理人員：CE035，需求單編號：MOB0022 匯入核心排程發信告知結果、修正手機險排程時間、修正保批單號資料型態、洗錢條件檢核補上批單號、遠傳資料批次下載使用者改ce035  --> 
				endorse_no = #endorseNo:VARCHAR#
			</isNotEmpty>
		</dynamic>
		<include refid="Utils.msSql2" />
	</select>

	<select id="selectByParams" parameterClass="java.util.Map" resultMap="BaseResultMap">
		select * from FET_MOBILE_POLICY
		<dynamic prepend="WHERE">
			<!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 START -->
			<isNotEmpty prepend="AND" property="dataSrc">
				data_src = #dataSrc#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="txId">
				tx_id = #txId#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="ctbcRcvNo">
				ctbc_rcv_no = #ctbcRcvNo#
			</isNotEmpty>
			<!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 END -->
			<isNotEmpty prepend="AND" property="transactionId">
				transaction_id = #transactionId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="contractId">
				contract_id = #contractId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="applicationId">
				application_id = #applicationId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="dataType">
				data_type = #dataType:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="status">
				status = #status:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="policyNo">
				policy_no = #policyNo:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="endorseNo">
			<!-- mantis：MOB0022，處理人員：CE035，需求單編號：MOB0022 匯入核心排程發信告知結果、修正手機險排程時間、修正保批單號資料型態、洗錢條件檢核補上批單號、遠傳資料批次下載使用者改ce035  --> 
				endorse_no = #endorseNo:VARCHAR#
			</isNotEmpty>
			<isEqual property="orderByEndorseNo" compareValue="Y" >
				ORDER BY ENDORSE_NO
			</isEqual>
			<isEqual property="orderByCreatedtimeDesc" compareValue="Y" >
				ORDER BY CREATED_TIME DESC
			</isEqual>			
			
		</dynamic>
	</select>

	<select id="count" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select COUNT(*) from FET_MOBILE_POLICY
		<dynamic prepend="WHERE">
			<!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 START -->
			<isNotEmpty prepend="AND" property="dataSrc">
				ct.data_src = #dataSrc#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="txId">
				tx_id = #txId#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="ctbcRcvNo">
				ctbc_rcv_no = #ctbcRcvNo#
			</isNotEmpty>
			<!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 END -->
			<isNotEmpty prepend="AND" property="transactionId">
				transaction_id = #transactionId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="contractId">
				contract_id = #contractId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="applicationId">
				application_id = #applicationId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="dataType">
				data_type = #dataType:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="status">
				status = #status:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="policyNo">
				policy_no = #policyNo:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="endorseNo">
			<!-- mantis：MOB0022，處理人員：CE035，需求單編號：MOB0022 匯入核心排程發信告知結果、修正手機險排程時間、修正保批單號資料型態、洗錢條件檢核補上批單號、遠傳資料批次下載使用者改ce035  --> 
				endorse_no = #endorseNo:VARCHAR#
			</isNotEmpty>
			<!-- mantis：MOB0022，處理人員：CE035，需求單編號：MOB0022 匯入核心排程發信告知結果、修正手機險排程時間、修正保批單號資料型態、洗錢條件檢核補上批單號、遠傳資料批次下載使用者改ce035  --> 
			<isNotEmpty prepend="AND" property="modifiedTimeLatterThan">
				modified_time >= #modifiedTimeLatterThan:VARCHAR#
			</isNotEmpty>
		</dynamic>
	</select>

	<delete id="deleteByEntity" parameterClass="com.tlg.msSqlMob.entity.FetMobilePolicy">
		delete from FET_MOBILE_POLICY
		where transaction_id = #transactionId:VARCHAR#
	</delete>

	<select id="selectByUK" resultMap="BaseResultMap"
		parameterClass="java.util.Map">
		SELECT * FROM FET_MOBILE_POLICY
		where transaction_id = #transactionId:VARCHAR#
	</select>

	<select id="countByUK" resultClass="java.lang.Integer"
		parameterClass="com.tlg.msSqlMob.entity.FetMobilePolicy">
		SELECT COUNT(*) FROM FET_MOBILE_POLICY
		where transaction_id = #transactionId:VARCHAR#
	</select>

	<insert id="insert" parameterClass="com.tlg.msSqlMob.entity.FetMobilePolicy">
		  insert into FET_MOBILE_POLICY (transaction_id, contract_id, application_id, data_type, status,
	      policy_no, endorse_no, endorse_type, endorse_text, start_date, end_date,
	      handler_identify_number, handler_name, insured_code, insured_name, head_name, birthday,
	      phone_tele_number, mobile, post_code, post_address, insured_identity, country_ename, domicile,
	      email, branch_code, branch_name, pay_no, plan_start_date, plan_end_date, created_by,
	      <!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 START -->
	      created_time, endorse_date, core_fail_msg, data_src , tx_id, ctbc_rcv_no)
	    values (#transactionId:VARCHAR#, #contractId:VARCHAR#, #applicationId:VARCHAR#,
	      #dataType:VARCHAR#, #status:VARCHAR#, #policyNo:VARCHAR#, #endorseNo:VARCHAR#,
	      #endorseType:VARCHAR#, #endorseText:VARCHAR#, #startDate:VARCHAR#, #endDate:VARCHAR#,
	      #handlerIdentifyNumber:VARCHAR#, #handlerName:VARCHAR#, #insuredCode:VARCHAR#,
	      #insuredName:VARCHAR#, #headName:VARCHAR#, #birthday:VARCHAR#, #phoneTeleNumber:VARCHAR#,
	      #mobile:VARCHAR#, #postCode:VARCHAR#, #postAddress:VARCHAR#, #insuredIdentity:VARCHAR#,
	      #countryEname:VARCHAR#, #domicile:VARCHAR#, #email:VARCHAR#, #branchCode:VARCHAR#,
	      #branchName:VARCHAR#, #payNo:VARCHAR#, #planStartDate:VARCHAR#, #planEndDate:VARCHAR#,
	      #createdBy:VARCHAR#, #createdTime:TIMESTAMP#, #endorseDate:VARCHAR#, #coreFailMsg:VARCHAR#,
	      #dataSrc:VARCHAR#, #txId:VARCHAR#, #ctbcRcvNo:VARCHAR#)
	      <!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 END -->
	</insert>

	<update id="update" parameterClass="com.tlg.msSqlMob.entity.FetMobilePolicy">
		update FET_MOBILE_POLICY
		<dynamic prepend="set">
			<isNotNull prepend="," property="contractId">
				contract_id = #contractId:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="applicationId">
				application_id = #applicationId:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dataType">
				data_type = #dataType:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="status">
				status = #status:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="policyNo">
				policy_no = #policyNo:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="endorseNo">
				endorse_no = #endorseNo:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="endorseType">
				endorse_type = #endorseType:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="endorseText">
				endorse_text = #endorseText:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="startDate">
				start_date = #startDate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="endDate">
				end_date = #endDate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="handlerIdentifyNumber">
				handler_identify_number = #handlerIdentifyNumber:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="handlerName">
				handler_name = #handlerName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="insuredCode">
				insured_code = #insuredCode:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="insuredName">
				insured_name = #insuredName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="headName">
				head_name = #headName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="birthday">
				birthday = #birthday:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="phoneTeleNumber">
				phone_tele_number = #phoneTeleNumber:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="mobile">
				mobile = #mobile:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="postCode">
				post_code = #postCode:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="postAddress">
				post_address = #postAddress:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="insuredIdentity">
				insured_identity = #insuredIdentity:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="countryEname">
				country_ename = #countryEname:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="domicile">
				domicile = #domicile:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="email">
				email = #email:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="branchCode">
				branch_code = #branchCode:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="branchName">
				branch_name = #branchName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="payNo">
				pay_no = #payNo:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="planStartDate">
				plan_start_date = #planStartDate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="planEndDate">
				plan_end_date = #planEndDate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="modifiedBy">
				modified_by = #modifiedBy:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="modifiedTime">
				modified_time = #modifiedTime:TIMESTAMP#
			</isNotNull>
			<isNotNull prepend="," property="endorseDate">
				endorse_date = #endorseDate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="coreFailMsg">
				core_fail_msg = #coreFailMsg:VARCHAR#
			</isNotNull>
			<!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 START -->
			<isNotNull prepend="," property="dataSrc">
				data_src = #dataSrc:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="txId">
				tx_id = #txId:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ctbcRcvNo">
				ctbc_rcv_no = #ctbcRcvNo:VARCHAR#
			</isNotNull>
			<!-- mantis：MOB0031，處理人員：CE035，需求單編號：MOB0031 行動裝置險estore網投案開發 出單流程 END -->
		</dynamic>
		where transaction_id = #transactionId:VARCHAR#
	</update>
</sqlMap>