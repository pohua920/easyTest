<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="UsageLog">

	<resultMap id="BaseResultMap" class="com.tlg.msSqlSms.entity.UsageLog" >
	    <result column="serial" property="serial" jdbcType="VARCHAR" />
	    <result column="target" property="target" jdbcType="VARCHAR" />
	    <result column="corp_id" property="corpId" jdbcType="VARCHAR" />
	    <result column="submit_date" property="submitDate" jdbcType="CHAR" />
	    <result column="deliver_date" property="deliverDate" jdbcType="CHAR" />
	    <result column="status_date" property="statusDate" jdbcType="CHAR" />
	    <result column="status" property="status" jdbcType="VARCHAR" />
	    <result column="mgw_id" property="mgwId" jdbcType="VARCHAR" />
	    <result column="message_id" property="messageId" jdbcType="VARCHAR" />
	    <result column="language" property="language" jdbcType="CHAR" />
	    <result column="message" property="message" jdbcType="VARCHAR" />
	    <result column="dr_flag" property="drFlag" jdbcType="CHAR" />
	    <result column="err_code" property="errCode" jdbcType="VARCHAR" />
	</resultMap>

	<select id="select" resultMap="BaseResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
		SELECT * FROM <include refid="Utils.msSqlSmsSchema"/>UsageLog
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="serial">
				serial = #serial#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="messageId">
				message_id = #messageId#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="target">
				target = #target#
			</isNotEmpty>
		</dynamic>
		<include refid="Utils.sql2" />
	</select>

	<select id="selectByParams" resultMap="BaseResultMap" parameterClass="java.util.Map">
		SELECT * FROM <include refid="Utils.msSqlSmsSchema"/>UsageLog
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="serial">
				serial = #serial#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="messageId">
				message_id = #messageId#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="target">
				target = #target#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="statusIsNull">
				(status = '' OR status is null)
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="selectBySubmitHour" resultMap="BaseResultMap" parameterClass="java.util.Map">
		SELECT Top 100 * FROM <include refid="Utils.msSqlSmsSchema"/>UsageLog 
		WHERE 1 = 1
		AND (mgw_id = '' OR mgw_id is null OR mgw_id = 'NULL')
		AND err_code = '00000'
  		AND message_id is not null
		ORDER BY SUBMIT_DATE
	</select>
 	
	<select id="count" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*) FROM <include refid="Utils.msSqlSmsSchema"/>UsageLog
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="serial">
				serial = #serial#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="messageId">
				message_id = #messageId#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="target">
				target = #target#
			</isNotEmpty>
		</dynamic>
	</select>
	
	
	<select id="selectByUK" resultClass="com.tlg.msSqlSms.entity.UsageLog" parameterClass="java.util.Map" >
		SELECT * FROM <include refid="Utils.msSqlSmsSchema"/>UsageLog
		where serial = #serial#
	</select>
	

	<select id="countByUK" resultClass="java.lang.Integer" parameterClass="com.tlg.msSqlSms.entity.UsageLog" >
		SELECT COUNT(*) FROM <include refid="Utils.msSqlSmsSchema"/>UsageLog
		where serial = #serial#
	</select>	

	 	
	<insert id="insert" parameterClass="com.tlg.msSqlSms.entity.UsageLog" >
		insert into <include refid="Utils.msSqlSmsSchema"/>UsageLog (serial, target, corp_id, submit_date, deliver_date, status_date, status,
      mgw_id, message_id, language, message, dr_flag, err_code)
    values (#serial:VARCHAR#, #target:VARCHAR#, #corpId:VARCHAR#, #submitDate:CHAR#,
      #deliverDate:CHAR#, #statusDate:CHAR#, #status:VARCHAR#, #mgwId:VARCHAR#, #messageId:VARCHAR#,
      #language:CHAR#, #message:VARCHAR#, #drFlag:CHAR#, #errCode:VARCHAR#)
	</insert>

	<delete id="deleteByEntity" parameterClass="com.tlg.msSqlSms.entity.UsageLog" >
    	DELETE FROM <include refid="Utils.msSqlSmsSchema"/>UsageLog
    	where serial = #serial:VARCHAR#
	</delete>
	
	<update id="updateResp" parameterClass="com.tlg.msSqlSms.entity.UsageLog">
		UPDATE <include refid="Utils.msSqlSmsSchema" />UsageLog
		<dynamic prepend="set">
			<isNotNull prepend="," property="mgwId">
				mgw_id = #mgwId:VARCHAR#
			</isNotNull>

		</dynamic>
		where 1 = 1
		and message_id = #messageId:VARCHAR#
		and target = #target:VARCHAR#
	</update>

	<update id="update" parameterClass="com.tlg.msSqlSms.entity.UsageLog">
		UPDATE <include refid="Utils.msSqlSmsSchema" />UsageLog
		<dynamic prepend="set">
			<isNotNull prepend="," property="corpId">
				corp_id = #corpId:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="submitDate">
				submit_date = #submitDate:CHAR#
			</isNotNull>
			<isNotNull prepend="," property="deliverDate">
				deliver_date = #deliverDate:CHAR#
			</isNotNull>
			<isNotNull prepend="," property="statusDate">
				status_date = #statusDate:CHAR#
			</isNotNull>
			<isNotNull prepend="," property="status">
				status = #status:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="mgwId">
				mgw_id = #mgwId:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="language">
				language = #language:CHAR#
			</isNotNull>
			<isNotNull prepend="," property="message">
				message = #message:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="drFlag">
				dr_flag = #drFlag:CHAR#
			</isNotNull>
			<isNotNull prepend="," property="errCode">
				err_code = #errCode:VARCHAR#
			</isNotNull>
		</dynamic>
		where serial = #serial:VARCHAR#
		AND message_id = #messageId:VARCHAR#
		AND target = #target:VARCHAR#
	</update>

</sqlMap>