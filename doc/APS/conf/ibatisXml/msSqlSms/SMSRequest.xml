<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="SMSRequest">

	<resultMap id="BaseResultMap" class="com.tlg.msSqlSms.entity.SMSRequest" >
	    <result column="serial" property="serial" jdbcType="VARCHAR" />
	    <result column="target" property="target" jdbcType="VARCHAR" />
	    <result column="corp_id" property="corpId" jdbcType="VARCHAR" />
	    <result column="submit_date" property="submitDate" jdbcType="VARCHAR" />
	    <result column="dr_flag" property="drFlag" jdbcType="VARCHAR" />
	    <result column="deliver_date" property="deliverDate" jdbcType="VARCHAR" />
	    <result column="language" property="language" jdbcType="VARCHAR" />
	    <result column="message" property="message" jdbcType="VARCHAR" />
	</resultMap>
	
	
	<select id="selectTopForSendMessage" resultMap="BaseResultMap" parameterClass="java.util.Map">
		SELECT Top 100 * FROM <include refid="Utils.msSqlSmsSchema"/>SMSRequest
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="serial">
				serial = #serial#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="target">
				target = #target#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="targetIsNotEmpty">
				(target is not null AND target != '')
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="messageIsNotNull">
				(message is not null AND message != '')
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="drFlag">
				dr_flag = #drFlag#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="drFlagNotEq">
				dr_flag != #drFlagNotEq#
			</isNotEmpty>			
			<isNotEmpty prepend="AND" property="submitDateSt">
				submit_date <![CDATA[<]]> #submitDateSt#
			</isNotEmpty>
			ORDER BY submit_date ASC	
		</dynamic>
	</select>

	<select id="select" resultMap="BaseResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
		SELECT * FROM <include refid="Utils.msSqlSmsSchema"/>SMSRequest
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="serial">
				serial = #serial#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="target">
				target = #target#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="drFlag">
				dr_flag = #drFlag#
			</isNotEmpty>
		</dynamic>
		<include refid="Utils.sql2" />
	</select>

	<select id="selectByParams" resultMap="BaseResultMap" parameterClass="java.util.Map">
		SELECT * FROM <include refid="Utils.msSqlSmsSchema"/>SMSRequest
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="serial">
				serial = #serial#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="target">
				target = #target#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="drFlag">
				dr_flag = #drFlag#
			</isNotEmpty>
		</dynamic>
	</select>
 	
	<select id="count" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*) FROM <include refid="Utils.msSqlSmsSchema"/>SMSRequest
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="serial">
				serial = #serial#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="target">
				target = #target#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="drFlag">
				dr_flag = #drFlag#
			</isNotEmpty>
		</dynamic>
	</select>

	<select id="selectByUK" resultClass="com.tlg.msSqlSms.entity.SMSRequest" parameterClass="java.util.Map" >
		SELECT * FROM <include refid="Utils.msSqlSmsSchema"/>SMSRequest
		where serial = #serial#
	</select>

	<select id="countByUK" resultClass="java.lang.Integer" parameterClass="com.tlg.msSqlSms.entity.SMSRequest" >
		SELECT COUNT(*) FROM <include refid="Utils.msSqlSmsSchema"/>SMSRequest
		where serial = #serial#
	</select>	

	 	
	<insert id="insert" parameterClass="com.tlg.msSqlSms.entity.SMSRequest" >
		insert into <include refid="Utils.msSqlSmsSchema"/>SMSRequest (serial, target, corp_id, submit_date, dr_flag, deliver_date, language,
      message)
    values (#serial:VARCHAR#, #target:VARCHAR#, #corpId:VARCHAR#, #submitDate:VARCHAR#, #drFlag:VARCHAR#,
      #deliverDate:VARCHAR#, #language:VARCHAR#, #message:VARCHAR#)
	</insert>

	<delete id="deleteByEntity" parameterClass="com.tlg.msSqlSms.entity.SMSRequest" >
    	DELETE FROM <include refid="Utils.msSqlSmsSchema"/>SMSRequest
    	where serial = #serial:VARCHAR#
	</delete>

	<delete id="deleteByNullData" >
    	DELETE <include refid="Utils.msSqlSmsSchema"/>SMSRequest where message is null or target = ''
	</delete>

	<update id="update" parameterClass="com.tlg.msSqlSms.entity.SMSRequest">
		UPDATE <include refid="Utils.msSqlSmsSchema" />SMSRequest
		<dynamic prepend="set">
			<isNotNull prepend="," property="target">
				target = #target:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="corpId">
				corp_id = #corpId:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="submitDate">
				submit_date = #submitDate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="drFlag">
				dr_flag = #drFlag:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="deliverDate">
				deliver_date = #deliverDate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="language">
				language = #language:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="message">
				message = #message:VARCHAR#
			</isNotNull>
		</dynamic>
		where serial = #serial:VARCHAR#
	</update>

</sqlMap>