<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<!-- mantis：FIR0547，處理人員：CC009，需求單編號：FIR0547 聯邦新件資料交換查詢作業 -->
<sqlMap namespace="FirAgtUb01">
  <resultMap class="com.tlg.prpins.entity.FirAgtUb01" id="BaseResultMap">
    <result column="OID" jdbcType="DECIMAL" property="oid" />
    <result column="BATCH_NO" jdbcType="VARCHAR" property="batchNo" />
    <result column="RISKCODE" jdbcType="VARCHAR" property="riskcode" />
    <result column="IS_PDF" jdbcType="VARCHAR" property="isPdf" />
    <result column="UB_DATE01" jdbcType="TIMESTAMP" property="ubDate01" />
    <result column="UB_DATE02" jdbcType="TIMESTAMP" property="ubDate02" />
    <result column="INS_NAME" jdbcType="VARCHAR" property="insName" />
    <result column="ORDERSEQ" jdbcType="VARCHAR" property="orderseq" />
    <result column="UB_TYPE" jdbcType="VARCHAR" property="ubType" />
    <result column="BRANCH_NAME" jdbcType="VARCHAR" property="branchName" />
    <result column="BRANCH_NO" jdbcType="VARCHAR" property="branchNo" />
    <result column="STARTDATE" jdbcType="TIMESTAMP" property="startdate" />
    <result column="UB_KINDCODE" jdbcType="VARCHAR" property="ubKindcode" />
    <result column="APPLY_NAME" jdbcType="VARCHAR" property="applyName" />
    <result column="APPLY_ID" jdbcType="VARCHAR" property="applyId" />
    <result column="INSURED_NAME" jdbcType="VARCHAR" property="insuredName" />
    <result column="INSURED_ID" jdbcType="VARCHAR" property="insuredId" />
    <result column="UB_SOURCE" jdbcType="VARCHAR" property="ubSource" />
    <result column="SALES_EID" jdbcType="VARCHAR" property="salesEid" />
    <result column="SALES_NAME" jdbcType="VARCHAR" property="salesName" />
    <result column="SALES_NO" jdbcType="VARCHAR" property="salesNo" />
    <result column="UB_STATUS" jdbcType="VARCHAR" property="ubStatus" />
    <result column="DELETE_FLAG" jdbcType="VARCHAR" property="deleteFlag" />
    <result column="ICREATE" jdbcType="VARCHAR" property="icreate" />
    <result column="DCREATE" jdbcType="TIMESTAMP" property="dcreate" />
  </resultMap>
  
  <resultMap class="com.tlg.aps.vo.Aps041MainVo" id="aps041MainVoResultMap">
  	<result column="ORDERSEQ" property="orderseq" jdbcType="VARCHAR" />
    <result column="RISKCODE" property="riskcode" jdbcType="VARCHAR" />
    <result column="DCREATE" jdbcType="TIMESTAMP" property="dcreate" />
    <result column="INSURED_NAME" property="insuredName" jdbcType="VARCHAR" />
    <result column="BRANCH_NAME" property="branchName" jdbcType="VARCHAR" />
    <result column="STARTDATE" property="startDate" jdbcType="TIMESTAMP" />
    <result column="UNDERWRITEENDDATE" property="underwriteenddate" jdbcType="TIMESTAMP" />
    <result column="POLICYNO" property="policyNo" jdbcType="VARCHAR" />
    <result column="FB_STATUS" property="fbStatus" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="select" parameterClass="java.util.Map" resultMap="BaseResultMap">
  	<include refid="Utils.sql1" />
    select *
    from FIR_AGT_UB_01
    <dynamic prepend="WHERE">
      <isNotNull prepend="AND" property="batchNo">
        BATCH_NO = #batchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="riskcode">
        RISKCODE = #riskcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="isPdf">
        IS_PDF = #isPdf:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="ubDate01">
        UB_DATE01 = #ubDate01:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="AND" property="ubDate02">
        UB_DATE02 = #ubDate02:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="AND" property="insName">
        INS_NAME = #insName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="orderseq">
        ORDERSEQ = #orderseq:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="ubType">
        UB_TYPE = #ubType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="branchName">
        BRANCH_NAME = #branchName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="branchNo">
        BRANCH_NO = #branchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="startdate">
        STARTDATE = #startdate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="AND" property="ubKindcode">
        UB_KINDCODE = #ubKindcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="applyName">
        APPLY_NAME = #applyName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="applyId">
        APPLY_ID = #applyId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="insuredName">
        INSURED_NAME = #insuredName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="insuredId">
        INSURED_ID = #insuredId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="ubSource">
        UB_SOURCE = #ubSource:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="salesEid">
        SALES_EID = #salesEid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="salesName">
        SALES_NAME = #salesName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="salesNo">
        SALES_NO = #salesNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="ubStatus">
        UB_STATUS = #ubStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="deleteFlag">
        DELETE_FLAG = #deleteFlag:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="icreate">
        ICREATE = #icreate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="dcreate">
        DCREATE = #dcreate:TIMESTAMP#
      </isNotNull>
    </dynamic>
    <include refid="Utils.sql2" />
  </select>
  <select id="selectByUK" parameterClass="java.util.Map" resultMap="BaseResultMap">
    select *
    from FIR_AGT_UB_01
    where OID = #oid:DECIMAL#
  </select>
  <delete id="deleteByEntity" parameterClass="com.tlg.prpins.entity.FirAgtUb01">
    delete from FIR_AGT_UB_01
    where OID = #oid:DECIMAL#
  </delete>
  <insert id="insert" parameterClass="com.tlg.prpins.entity.FirAgtUb01">
  	<selectKey resultClass="java.math.BigDecimal" keyProperty="oid" >
		SELECT FIR_AGT_UB_01_SEQ.NEXTVAL AS OID FROM DUAL    
	</selectKey>
    insert into FIR_AGT_UB_01 (OID, BATCH_NO, RISKCODE, IS_PDF, UB_DATE01, 
      UB_DATE02, INS_NAME, ORDERSEQ, UB_TYPE, BRANCH_NAME, 
      BRANCH_NO, STARTDATE, UB_KINDCODE, APPLY_NAME, 
      APPLY_ID, INSURED_NAME, INSURED_ID, UB_SOURCE, 
      SALES_EID, SALES_NAME, SALES_NO, UB_STATUS, DELETE_FLAG, 
      ICREATE, DCREATE)
    values (#oid:DECIMAL#, #batchNo:VARCHAR#, #riskcode:VARCHAR#, #isPdf:VARCHAR#, #ubDate01:TIMESTAMP#, 
      #ubDate02:TIMESTAMP#, #insName:VARCHAR#, #orderseq:VARCHAR#, #ubType:VARCHAR#, #branchName:VARCHAR#, 
      #branchNo:VARCHAR#, #startdate:TIMESTAMP#, #ubKindcode:VARCHAR#, #applyName:VARCHAR#, 
      #applyId:VARCHAR#, #insuredName:VARCHAR#, #insuredId:VARCHAR#, #ubSource:VARCHAR#, 
      #salesEid:VARCHAR#, #salesName:VARCHAR#, #salesNo:VARCHAR#, #ubStatus:VARCHAR#, #deleteFlag:VARCHAR#, 
      #icreate:VARCHAR#, #dcreate:TIMESTAMP#)
  </insert>
  <select id="count" parameterClass="java.util.Map" resultClass="java.lang.Integer">
    select count(*) from FIR_AGT_UB_01
    <dynamic prepend="WHERE">
      <isNotNull prepend="AND" property="batchNo">
        BATCH_NO = #batchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="riskcode">
        RISKCODE = #riskcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="isPdf">
        IS_PDF = #isPdf:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="ubDate01">
        UB_DATE01 = #ubDate01:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="AND" property="ubDate02">
        UB_DATE02 = #ubDate02:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="AND" property="insName">
        INS_NAME = #insName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="orderseq">
        ORDERSEQ = #orderseq:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="ubType">
        UB_TYPE = #ubType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="branchName">
        BRANCH_NAME = #branchName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="branchNo">
        BRANCH_NO = #branchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="startdate">
        STARTDATE = #startdate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="AND" property="ubKindcode">
        UB_KINDCODE = #ubKindcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="applyName">
        APPLY_NAME = #applyName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="applyId">
        APPLY_ID = #applyId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="insuredName">
        INSURED_NAME = #insuredName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="insuredId">
        INSURED_ID = #insuredId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="ubSource">
        UB_SOURCE = #ubSource:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="salesEid">
        SALES_EID = #salesEid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="salesName">
        SALES_NAME = #salesName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="salesNo">
        SALES_NO = #salesNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="ubStatus">
        UB_STATUS = #ubStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="deleteFlag">
        DELETE_FLAG = #deleteFlag:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="icreate">
        ICREATE = #icreate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="dcreate">
        DCREATE = #dcreate:TIMESTAMP#
      </isNotNull>
    </dynamic>
  </select>
  <update id="update" parameterClass="com.tlg.prpins.entity.FirAgtUb01">
    update FIR_AGT_UB_01
    <dynamic prepend="set">
      <isNotNull prepend="," property="batchNo">
        BATCH_NO = #batchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="riskcode">
        RISKCODE = #riskcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="isPdf">
        IS_PDF = #isPdf:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ubDate01">
        UB_DATE01 = #ubDate01:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="ubDate02">
        UB_DATE02 = #ubDate02:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="insName">
        INS_NAME = #insName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderseq">
        ORDERSEQ = #orderseq:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ubType">
        UB_TYPE = #ubType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="branchName">
        BRANCH_NAME = #branchName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="branchNo">
        BRANCH_NO = #branchNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="startdate">
        STARTDATE = #startdate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="ubKindcode">
        UB_KINDCODE = #ubKindcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="applyName">
        APPLY_NAME = #applyName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="applyId">
        APPLY_ID = #applyId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="insuredName">
        INSURED_NAME = #insuredName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="insuredId">
        INSURED_ID = #insuredId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ubSource">
        UB_SOURCE = #ubSource:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="salesEid">
        SALES_EID = #salesEid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="salesName">
        SALES_NAME = #salesName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="salesNo">
        SALES_NO = #salesNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ubStatus">
        UB_STATUS = #ubStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deleteFlag">
        DELETE_FLAG = #deleteFlag:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="icreate">
        ICREATE = #icreate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dcreate">
        DCREATE = #dcreate:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where OID = #oid:DECIMAL#
  </update>
  
  <select id="selectForAps041" resultMap="aps041MainVoResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
		SELECT DTL.ORDERSEQ, UB01.RISKCODE, DTL.DCREATE, UB01.INSURED_NAME, UB01.BRANCH_NAME, 
			PM.STARTDATE, PM.UNDERWRITEENDDATE, PM.POLICYNO, DECODE(UB02.ORDER_TYPE,NULL,'N','Y') AS FB_STATUS
		FROM FIR_AGT_UB_01 UB01
		LEFT JOIN FIR_AGT_BATCH_DTL DTL ON UB01.BATCH_NO = DTL.BATCH_NO AND UB01.ORDERSEQ = DTL.ORDERSEQ AND DTL.DATA_TYPE = '4'
		LEFT JOIN PRPCMAIN PM ON DTL.ORDERSEQ = PM.ORDERSEQ
		LEFT JOIN FIR_AGT_UB_02 UB02 ON UB01.ORDERSEQ = UB02.ORDERSEQ AND UB02.ENDORSENO IS NULL
		WHERE UB01.DELETE_FLAG = 'N'
		<isNotEmpty prepend="AND" property="startDate">
			UB01.DCREATE <![CDATA[>=]]> to_date(#startDate# , 'yyyy/mm/dd hh24:mi:ss')
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			UB01.DCREATE <![CDATA[<=]]> to_date(#endDate# , 'yyyy/mm/dd hh24:mi:ss')
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="orderseq">
			UB01.ORDERSEQ = #orderseq#
		</isNotEmpty>
		<include refid="Utils.sql2" />
	</select>
	
	<select id="countForAps041" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*) FROM FIR_AGT_UB_01 UB01
		LEFT JOIN FIR_AGT_BATCH_DTL DTL ON UB01.BATCH_NO = DTL.BATCH_NO AND UB01.ORDERSEQ = DTL.ORDERSEQ AND DTL.DATA_TYPE = '4'
		LEFT JOIN PRPCMAIN PM ON DTL.ORDERSEQ = PM.ORDERSEQ
		LEFT JOIN FIR_AGT_UB_02 UB02 ON UB01.ORDERSEQ = UB02.ORDERSEQ AND UB02.ENDORSENO IS NULL
		WHERE UB01.DELETE_FLAG = 'N'
		<isNotEmpty prepend="AND" property="startDate">
			UB01.DCREATE <![CDATA[>=]]> to_date(#startDate# , 'yyyy/mm/dd hh24:mi:ss')
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			UB01.DCREATE <![CDATA[<=]]> to_date(#endDate# , 'yyyy/mm/dd hh24:mi:ss')
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="orderseq">
			UB01.ORDERSEQ = #orderseq#
		</isNotEmpty>
	</select>
</sqlMap>