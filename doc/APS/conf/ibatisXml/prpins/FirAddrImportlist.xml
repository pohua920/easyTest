<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<!-- 
mantis：FIR0183，處理人員：BJ085，需求單編號：FIR0183 火險地址資料匯入 start
-->
<sqlMap namespace="FirAddrImportlist">
  <resultMap id="BaseResultMap" class="com.tlg.prpins.entity.FirAddrImportlist" >

    <result column="OID" property="oid" jdbcType="DECIMAL" />
    <result column="FILENAME_ORI" property="filenameOri" jdbcType="VARCHAR" />
    <result column="FILENAME_NEW" property="filenameNew" jdbcType="VARCHAR" />
    <result column="FILE_STATUS" property="fileStatus" jdbcType="VARCHAR" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
    <result column="QTY_ALL" property="qtyAll" jdbcType="DECIMAL" />
    <result column="QTY_OK" property="qtyOk" jdbcType="DECIMAL" />
    <result column="QTY_NG" property="qtyNg" jdbcType="DECIMAL" />
    <result column="DELETE_FLAG" property="deleteFlag" jdbcType="VARCHAR" />
    <result column="ICREATE" property="icreate" jdbcType="VARCHAR" />
    <result column="DCREATE" property="dcreate" jdbcType="TIMESTAMP" />
    <result column="IUPDATE" property="iupdate" jdbcType="VARCHAR" />
    <result column="DUPDATE" property="dupdate" jdbcType="TIMESTAMP" />
    <result column="ULTYPE" property="ultype" jdbcType="VARCHAR" />
  </resultMap>

  <select id="select" resultMap="BaseResultMap" parameterClass="java.util.Map">
  	<include refid="Utils.sql1"/>
		SELECT OID,FILENAME_ORI,FILENAME_NEW,
		CASE 
		    WHEN FILE_STATUS = 'N' THEN '未處理'
		    WHEN FILE_STATUS = 'Y' THEN '已處理'
		    WHEN FILE_STATUS = 'E' THEN '異常'
		    WHEN FILE_STATUS = 'X' THEN '不處理'
		    ELSE '未定義'
		END AS FILE_STATUS,
		QTY_ALL,REMARK,QTY_OK,QTY_NG,ICREATE,DCREATE,IUPDATE,DUPDATE,DELETE_FLAG,ULTYPE
 		FROM <include refid="Utils.prpinsSchema"/>FIR_ADDR_IMPORTLIST
		WHERE DELETE_FLAG = 'N'
	      <isNotEmpty property="fileStatus" prepend="AND">
	        FILE_STATUS = #fileStatus:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="startCreateDate">
			DCREATE <![CDATA[>=]]> to_date(#startCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="endCreateDate">
			DCREATE <![CDATA[<=]]> to_date(#endCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="ultype">
			ULTYPE = #ultype:VARCHAR#
		  </isNotEmpty>
  	<include refid="Utils.sql2"/>
  </select>
  
  <select id="selectByParams" resultMap="BaseResultMap" parameterClass="java.util.Map">
		SELECT * FROM <include refid="Utils.prpinsSchema"/>FIR_ADDR_IMPORTLIST
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="fileStatus">
				FILE_STATUS = #fileStatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="ultype">
				ULTYPE = #ultype:VARCHAR#
		  	</isNotEmpty>
		</dynamic>
		ORDER BY DCREATE DESC
	</select>

  <delete id="delete" parameterClass="com.tlg.prpins.entity.FirAddrImportlist" >
    delete from <include refid="Utils.prpinsSchema"/>FIR_ADDR_IMPORTLIST
    where OID = #oid:DECIMAL#
  </delete>

  <select id="count" parameterClass="java.util.Map" resultClass="java.lang.Integer">
    SELECT COUNT(*) FROM <include refid="Utils.prpinsSchema"/> FIR_ADDR_IMPORTLIST 
    WHERE DELETE_FLAG = 'N'
	  	<isNotEmpty property="fileStatus" prepend="AND">
	        FILE_STATUS = #fileStatus:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="startCreateDate">
			DCREATE <![CDATA[>=]]> to_date(#startCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="endCreateDate">
			DCREATE <![CDATA[<=]]> to_date(#endCreateDate# , 'yyyy/mm/dd hh24:mi:ss')
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="ultype">
			ULTYPE = #ultype:VARCHAR#
		  </isNotEmpty>
  </select>

  <insert id="insert" parameterClass="com.tlg.prpins.entity.FirAddrImportlist" >
  	<selectKey resultClass="java.math.BigDecimal" keyProperty="oid" >    
		SELECT FIR_ADDR_IMPORTLIST_SEQ.NEXTVAL AS OID FROM DUAL    
	</selectKey>
    insert into <include refid="Utils.prpinsSchema"/>FIR_ADDR_IMPORTLIST (OID, FILENAME_ORI, FILENAME_NEW, FILE_STATUS, REMARK, QTY_ALL,
      QTY_OK, QTY_NG, DELETE_FLAG, ICREATE, DCREATE, IUPDATE, DUPDATE, ULTYPE)
    values (#oid:DECIMAL#, #filenameOri:VARCHAR#, #filenameNew:VARCHAR#, #fileStatus:VARCHAR#,
      #remark:VARCHAR#, #qtyAll:DECIMAL#, #qtyOk:DECIMAL#, #qtyNg:DECIMAL#, #deleteFlag:VARCHAR#,
      #icreate:VARCHAR#, #dcreate:TIMESTAMP#, #iupdate:VARCHAR#, #dupdate:TIMESTAMP#, #ultype:VARCHAR#)
  </insert>
  

  <update id="update" parameterClass="com.tlg.prpins.entity.FirAddrImportlist">
    update <include refid="Utils.prpinsSchema"/>FIR_ADDR_IMPORTLIST
    <dynamic prepend="set" >
      <isNotNull prepend="," property="filenameOri" >
        FILENAME_ORI = #filenameOri:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fileStatus" >
        FILE_STATUS = #fileStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        REMARK = #remark:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="qtyAll" >
        QTY_ALL = #qtyAll:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="qtyOk" >
        QTY_OK = #qtyOk:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="qtyNg" >
        QTY_NG = #qtyNg:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="deleteFlag" >
        DELETE_FLAG = #deleteFlag:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="icreate" >
        ICREATE = #icreate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dcreate" >
        DCREATE = #dcreate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="iupdate" >
        IUPDATE = #iupdate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="dupdate" >
        DUPDATE = #dupdate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="ultype" >
        ULTYPE = #ultype:VARCHAR#
      </isNotNull>
    </dynamic>
    where FILENAME_NEW = #filenameNew:VARCHAR#
  </update>

</sqlMap>