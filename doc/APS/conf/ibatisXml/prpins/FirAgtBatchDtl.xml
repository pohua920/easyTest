<?xml version="1.0" encoding="UTF-8" ?>
<!-- mantis：FIR0266，處理人員：BJ085，需求單編號：FIR0266 板信資料交換處理作業 start -->
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="FirAgtBatchDtl" >
  <resultMap id="BaseResultMap" class="com.tlg.prpins.entity.FirAgtBatchDtl" >
    <result column="BATCH_NO" property="batchNo" jdbcType="VARCHAR" />
    <result column="ORDERSEQ" property="orderseq" jdbcType="VARCHAR" />
    <result column="BUSINESSNATURE" property="businessnature" jdbcType="VARCHAR" />
    <result column="ORDERSEQ_STATUS" property="orderseqStatus" jdbcType="VARCHAR" />
    <result column="RISKCODE" property="riskcode" jdbcType="VARCHAR" />
    <result column="DATA_TYPE" property="dataType" jdbcType="VARCHAR" />
    <result column="CORE_NO" property="coreNo" jdbcType="VARCHAR" />
    <result column="DELETE_FLAG" property="deleteFlag" jdbcType="VARCHAR" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
    <result column="DATA_SOURCE" property="dataSource" jdbcType="VARCHAR" />
    <result column="ICREATE" property="icreate" jdbcType="VARCHAR" />
    <result column="DCREATE" property="dcreate" jdbcType="TIMESTAMP" />
    <result column="IUPDATE" property="iupdate" jdbcType="VARCHAR" />
    <result column="DUPDATE" property="dupdate" jdbcType="TIMESTAMP" />
  </resultMap>
  
  <resultMap class="com.tlg.aps.vo.Aps009Detail01Vo" id="aps009Detail01VoResultMap">
  	<result column="BATCH_NO" property="batchNo" jdbcType="VARCHAR" />
    <result column="ORDERSEQ" property="orderseq" jdbcType="VARCHAR" />
    <result column="BUSINESSNATURE" property="businessnature" jdbcType="VARCHAR" />
    <result column="ORDERSEQ_STATUS" property="orderseqStatus" jdbcType="VARCHAR" />
    <result column="RISKCODE" property="riskcode" jdbcType="VARCHAR" />
    <result column="DATA_TYPE" property="dataType" jdbcType="VARCHAR" />
    <result column="CORE_NO" property="coreNo" jdbcType="VARCHAR" />
    <result column="DELETE_FLAG" property="deleteFlag" jdbcType="VARCHAR" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
    <result column="DATA_SOURCE" property="dataSource" jdbcType="VARCHAR" />
    <result column="ICREATE" property="icreate" jdbcType="VARCHAR" />
    <result column="DCREATE" property="dcreate" jdbcType="TIMESTAMP" />
    <result column="IUPDATE" property="iupdate" jdbcType="VARCHAR" />
    <result column="DUPDATE" property="dupdate" jdbcType="TIMESTAMP" />
    
    <result column="STARTDATE" property="startDate" jdbcType="TIMESTAMP" />
    <result column="INSUREDNAME" property="insuredName" jdbcType="VARCHAR" />
    <result column="EXTRACOMCODE" property="extraComcode" jdbcType="VARCHAR" />
    <result column="COMCODE" property="comcode" jdbcType="VARCHAR" />
    <result column="HANDLER1NAME" property="handler1Name" jdbcType="VARCHAR" />
  </resultMap>
  
  <!-- mantis：FIR0495，處理人員：CC009，需求單編號：FIR0495_住火-APS板信回饋檔-排程查詢作業 start -->
  <resultMap class="com.tlg.aps.vo.Aps038DetailVo" id="aps038DetailVoResultMap">
  	<result column="BATCH_NO" property="batchNo" jdbcType="VARCHAR" />
    <result column="ORDERSEQ" property="orderseq" jdbcType="VARCHAR" />
    <result column="ORDERSEQ_STATUS" property="orderseqStatus" jdbcType="VARCHAR" />
    <result column="RISKCODE" property="riskcode" jdbcType="VARCHAR" />
    <result column="DATA_TYPE" property="dataType" jdbcType="VARCHAR" />
    <result column="CORE_NO" property="coreNo" jdbcType="VARCHAR" />
    <result column="STARTDATE" property="startDate" jdbcType="TIMESTAMP" />
    <result column="INSUREDNAME" property="insuredName" jdbcType="VARCHAR" />
    <result column="EXTRACOMCODE" property="extraComcode" jdbcType="VARCHAR" />
    <result column="COMCODE" property="comcode" jdbcType="VARCHAR" />
    <result column="HANDLER1NAME" property="handler1Name" jdbcType="VARCHAR" />
  </resultMap>
  <!-- mantis：FIR0495，處理人員：CC009，需求單編號：FIR0495_住火-APS板信回饋檔-排程查詢作業 end -->
  
  <!-- mantis：FIR0547，處理人員：CC009，需求單編號：FIR0547 聯邦新件資料交換查詢作業 start -->
  <resultMap class="com.tlg.aps.vo.Aps041DetailVo1" id="aps041DetailVo1ResultMap">
  	<result column="ORDERSEQ" property="orderseq" jdbcType="VARCHAR" />
    <result column="RISKCODE" property="riskcode" jdbcType="VARCHAR" />
    <result column="STARTDATE" property="startDate" jdbcType="TIMESTAMP" />
    <result column="INSURED_NAME" property="insuredName" jdbcType="VARCHAR" />
    <result column="BRANCH_NAME" property="branchName" jdbcType="VARCHAR" />
    <result column="BRANCH_NO" property="branchNo" jdbcType="VARCHAR" />
    <result column="POLICYNO" property="policyNo" jdbcType="VARCHAR" />
    <result column="UNDERWRITEENDDATE" property="underwriteenddate" jdbcType="TIMESTAMP" />
    <result column="IS_PDF" property="isPdf" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap class="com.tlg.aps.vo.Aps041DetailVo2" id="aps041DetailVo2ResultMap">
  	<result column="ORDERSEQ" property="orderseq" jdbcType="VARCHAR" />
  	<result column="ORDERSEQ_STATUS" property="orderseqStatus" jdbcType="VARCHAR" />
    <result column="RISKCODE" property="riskcode" jdbcType="VARCHAR" />
    <result column="CORE_NO" property="coreNo" jdbcType="VARCHAR" />
    <result column="STARTDATE" property="startDate" jdbcType="TIMESTAMP" />
    <result column="UNDERWRITEENDDATE" property="underwriteenddate" jdbcType="TIMESTAMP" />
    <result column="INSURED_NAME" property="insuredName" jdbcType="VARCHAR" />
    <result column="BRANCH_NAME" property="branchName" jdbcType="VARCHAR" />
  	<result column="ORDER_TYPE" property="orderType" jdbcType="VARCHAR" />
    <result column="POLICYNO" property="policyNo" jdbcType="VARCHAR" />
  </resultMap>
  <!-- mantis：FIR0547，處理人員：CC009，需求單編號：FIR0547 聯邦新件資料交換查詢作業 end -->
  
  <!-- mantis：FIR0545，處理人員：BJ085，需求單編號：FIR0545 火險_聯邦新件_APS要保資料接收排程 start -->
   <resultMap class="com.tlg.aps.vo.FirUbProcessVo" id="ubProposalDtlResultMap">
  	<result column="BATCH_NO" property="batchNo" jdbcType="VARCHAR" />
    <result column="ORDERSEQ" property="orderseq" jdbcType="VARCHAR" />
    <result column="RISKCODE" property="riskcode" jdbcType="VARCHAR" />
    <result column="IS_PDF" property="isPdf" jdbcType="VARCHAR" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
  </resultMap>
  <!-- mantis：FIR0545，處理人員：BJ085，需求單編號：FIR0545 火險_聯邦新件_APS要保資料接收排程 end -->
  
  <!-- mantis：FIR0546，處理人員：BJ085，需求單編號：FIR0546 火險_聯邦新件_APS回饋檔產生排程 start -->
  <resultMap class="com.tlg.prpins.entity.FirAgtUb02" id="ub02ResultMap">
    <result column="OID" jdbcType="DECIMAL" property="oid" />
    <result column="BATCH_NO" jdbcType="VARCHAR" property="batchNo" />
    <result column="RISKCODE" jdbcType="VARCHAR" property="riskcode" />
    <result column="POLICYNO" jdbcType="VARCHAR" property="policyno" />
    <result column="ORDERSEQ" jdbcType="VARCHAR" property="orderseq" />
    <result column="ENDORSENO" jdbcType="VARCHAR" property="endorseno" />
    <result column="RISKCODE_UB" jdbcType="VARCHAR" property="riskcodeUb" />
    <result column="DATA_DATE" jdbcType="TIMESTAMP" property="dataDate" />
    <result column="STARTDATE" jdbcType="TIMESTAMP" property="startdate" />
    <result column="ENDDATE" jdbcType="TIMESTAMP" property="enddate" />
    <result column="UNDERWRITEENDDATE" jdbcType="TIMESTAMP" property="underwriteenddate" />
    <result column="ORDER_TYPE" jdbcType="VARCHAR" property="orderType" />
    <result column="POLICY_STATUS" jdbcType="VARCHAR" property="policyStatus" />
    <result column="ENDORSETEXT" jdbcType="VARCHAR" property="endorsetext" />
    <result column="IS_RENEW" jdbcType="VARCHAR" property="isRenew" />
    <result column="PREMIUM_Q" jdbcType="DECIMAL" property="premiumQ" />
    <result column="PREMIUM_F" jdbcType="DECIMAL" property="premiumF" />
    <result column="PREMIUM_A" jdbcType="DECIMAL" property="premiumA" />
    <result column="PREMIUM_T" jdbcType="DECIMAL" property="premiumT" />
    <result column="AMOUNT_Q" jdbcType="DECIMAL" property="amountQ" />
    <result column="AMOUNT_F" jdbcType="DECIMAL" property="amountF" />
    <result column="COMM_RATE_Q" jdbcType="DECIMAL" property="commRateQ" />
    <result column="COMM_RATE_F" jdbcType="DECIMAL" property="commRateF" />
    <result column="COMMISSION_Q" jdbcType="DECIMAL" property="commissionQ" />
    <result column="COMMISSION_F" jdbcType="DECIMAL" property="commissionF" />
    <result column="COMMISSION" jdbcType="DECIMAL" property="commission" />
    <result column="SERVICE_CHARGE" jdbcType="DECIMAL" property="serviceCharge" />
    <result column="SALES_NO" jdbcType="VARCHAR" property="salesNo" />
    <result column="IS_AUTO_RENEW" jdbcType="VARCHAR" property="isAutoRenew" />
    <result column="OLD_POLICYNO" jdbcType="VARCHAR" property="oldPolicyno" />
    <result column="OLD_ENDDATE" jdbcType="TIMESTAMP" property="oldEnddate" />
    <result column="SUMFLOORS" jdbcType="DECIMAL" property="sumfloors" />
    <result column="WALLNO" jdbcType="VARCHAR" property="wallno" />
    <result column="WALLNO_OTHER" jdbcType="VARCHAR" property="wallnoOther" />
    <result column="ROOFNO" jdbcType="VARCHAR" property="roofno" />
    <result column="ROOFNO_OTHER" jdbcType="VARCHAR" property="roofnoOther" />
    <result column="ADDRESS" jdbcType="VARCHAR" property="address" />
    <result column="MORTGAGEEPCODE1" jdbcType="VARCHAR" property="mortgageepcode1" />
    <result column="UB_SOURCE" jdbcType="VARCHAR" property="ubSource" />
    <result column="APPLY_NAME" jdbcType="VARCHAR" property="applyName" />
    <result column="APPLY_ID" jdbcType="VARCHAR" property="applyId" />
    <result column="INSURED_NAME" jdbcType="VARCHAR" property="insuredName" />
    <result column="INSURED_ID" jdbcType="VARCHAR" property="insuredId" />
    <result column="DELETE_FLAG" jdbcType="VARCHAR" property="deleteFlag" />
    <result column="ICREATE" jdbcType="VARCHAR" property="icreate" />
    <result column="DCREATE" jdbcType="TIMESTAMP" property="dcreate" />
    <result column="IUPDATE" jdbcType="VARCHAR" property="iupdate" />
    <result column="DUPDATE" jdbcType="TIMESTAMP" property="dupdate" />
  </resultMap>
  
  <resultMap class="com.tlg.aps.vo.FirUbProcessVo" id="ubBackFileDtlResultMap">
    <result column="ORDERSEQ" property="orderseq" jdbcType="VARCHAR" />
    <result column="RISKCODE" property="riskcode" jdbcType="VARCHAR" />
    <result column="ORDERSEQ_STATUS" property="orderseqStatus" jdbcType="VARCHAR" />
    <result column="CORE_NO" property="coreNo" jdbcType="VARCHAR" />
    <result column="DATA_TYPE" property="dataType" jdbcType="VARCHAR" />
  </resultMap>
  <!-- mantis：FIR0546，處理人員：BJ085，需求單編號：FIR0546 火險_聯邦新件_APS回饋檔產生排程 end -->
 
	<select id="select" resultMap="BaseResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
			SELECT * FROM <include refid="Utils.prpinsSchema"/> FIR_AGT_BATCH_DTL
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				BATCH_NO = #batchNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderseq">
				ORDERSEQ = #orderseq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderseqStatus">
				ORDERSEQ_STATUS = #orderseqStatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="riskcode">
				RISKCODE = #riskcode#
			</isNotEmpty>
		</dynamic>
		<include refid="Utils.sql2" />
	</select>
	
	<select id="selectForAps009Detail01" resultMap="aps009Detail01VoResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
		SELECT DTL.*, PM.STARTDATE, PINS.INSUREDNAME, PM.EXTRACOMCODE, PM.COMCODE, PM.HANDLER1NAME
		FROM  <include refid="Utils.prpinsSchema"/> FIR_AGT_BATCH_DTL DTL
		LEFT JOIN PRPTMAIN PM ON DTL.CORE_NO = PM.PROPOSALNO
		LEFT JOIN 
		(SELECT PROPOSALNO, MIN(SERIALNO) AS SERIALNO 
		FROM PRPTINSURED WHERE RISKCODE IN ('F01', 'F02') AND INSUREDFLAG = '1' 
		GROUP BY PROPOSALNO) 
		PINS_SNO ON PM.PROPOSALNO = PINS_SNO.PROPOSALNO
		LEFT JOIN PRPTINSURED PINS ON PINS.PROPOSALNO = PINS_SNO.PROPOSALNO
		AND PINS.SERIALNO = PINS_SNO.SERIALNO
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
		</dynamic>
		<include refid="Utils.sql2" />
	</select>
	
	<select id="countForAps009Detail01" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*) FROM <include refid="Utils.prpinsSchema"/> FIR_AGT_BATCH_DTL DTL
		LEFT JOIN PRPTMAIN PM ON DTL.CORE_NO = PM.PROPOSALNO
		LEFT JOIN 
		(SELECT PROPOSALNO, MIN(SERIALNO) AS SERIALNO 
		FROM PRPTINSURED WHERE RISKCODE IN ('F01', 'F02') AND INSUREDFLAG = '1' 
		GROUP BY PROPOSALNO) 
		PINS_SNO ON PM.PROPOSALNO = PINS_SNO.PROPOSALNO
		LEFT JOIN PRPTINSURED PINS ON PINS.PROPOSALNO = PINS_SNO.PROPOSALNO
		AND PINS.SERIALNO = PINS_SNO.SERIALNO
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
		</dynamic>
	</select>

	<select id="selectForAps009Detail03" resultMap="aps009Detail01VoResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
		SELECT DTL.*, PM.STARTDATE, PINS.INSUREDNAME, PM.EXTRACOMCODE, PM.COMCODE, PM.HANDLER1NAME
		FROM  <include refid="Utils.prpinsSchema"/> FIR_AGT_BATCH_DTL DTL
		LEFT JOIN PRPCMAIN PM ON DTL.CORE_NO = PM.POLICYNO
		LEFT JOIN 
		(SELECT POLICYNO, MIN(SERIALNO) AS SERIALNO 
		FROM PRPCINSURED WHERE RISKCODE IN ('F01', 'F02') AND INSUREDFLAG = '1' 
		GROUP BY POLICYNO) 
		PINS_SNO ON PM.POLICYNO = PINS_SNO.POLICYNO
		LEFT JOIN PRPCINSURED PINS ON PINS.POLICYNO = PINS_SNO.POLICYNO
		AND PINS.SERIALNO = PINS_SNO.SERIALNO
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
		</dynamic>
		<include refid="Utils.sql2" />
	</select>
	
	<select id="countForAps009Detail03" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*) FROM <include refid="Utils.prpinsSchema"/> FIR_AGT_BATCH_DTL DTL
		LEFT JOIN PRPCMAIN PM ON DTL.CORE_NO = PM.POLICYNO
		LEFT JOIN 
		(SELECT POLICYNO, MIN(SERIALNO) AS SERIALNO 
		FROM PRPCINSURED WHERE RISKCODE IN ('F01', 'F02') AND INSUREDFLAG = '1' 
		GROUP BY POLICYNO) 
		PINS_SNO ON PM.POLICYNO = PINS_SNO.POLICYNO
		LEFT JOIN PRPCINSURED PINS ON PINS.POLICYNO = PINS_SNO.POLICYNO
		AND PINS.SERIALNO = PINS_SNO.SERIALNO
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="selectByParams" resultMap="BaseResultMap" parameterClass="java.util.Map">
		SELECT * FROM <include refid="Utils.prpinsSchema"/>FIR_AGT_BATCH_DTL
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				BATCH_NO = #batchNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="businessnature">
				BUSINESSNATURE = #businessnature#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderseq">
				ORDERSEQ = #orderseq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderseqStatus">
				ORDERSEQ_STATUS = #orderseqStatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="riskcode">
				RISKCODE = #riskcode#
			</isNotEmpty>
			<!-- mantis：FIR0545，處理人員：BJ085，需求單編號：FIR0545 火險_聯邦新件_APS要保資料接收排程 start -->
			<isNotEmpty prepend="AND" property="notBatchNo">
				BATCH_NO <![CDATA[<>]]> #notBatchNo#
			</isNotEmpty>
			<!-- mantis：FIR0545，處理人員：BJ085，需求單編號：FIR0545 火險_聯邦新件_APS要保資料接收排程 end -->
		</dynamic>
		<!-- mantis：FIR0494，處理人員：CC009，需求單編號：FIR0494_板信回饋檔產生排程規格_新版 START -->
		<isNotEmpty property="sortBy">
			ORDER BY $sortBy$ $sortType$ 
		</isNotEmpty>
		<!-- mantis：FIR0494，處理人員：CC009，需求單編號：FIR0494_板信回饋檔產生排程規格_新版 END -->
	</select>

	<select id="count" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*) FROM <include refid="Utils.prpinsSchema"/>FIR_AGT_BATCH_DTL
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				BATCH_NO = #batchNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="businessnature">
				BUSINESSNATURE = #businessnature#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderseq">
				ORDERSEQ = #orderseq#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orderseqStatus">
				ORDERSEQ_STATUS = #orderseqStatus#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="riskcode">
				RISKCODE = #riskcode#
			</isNotEmpty>
		</dynamic>
	</select>
  
	<delete id="delete" parameterClass="com.tlg.prpins.entity.FirAgtBatchDtl" >
	  delete from <include refid="Utils.prpinsSchema"/> FIR_AGT_BATCH_DTL
	  where BATCH_NO = #batchNo:VARCHAR#
	    and ORDERSEQ = #orderseq:VARCHAR#
	</delete>

	<insert id="insert" parameterClass="com.tlg.prpins.entity.FirAgtBatchDtl" >
	  insert into <include refid="Utils.prpinsSchema"/> FIR_AGT_BATCH_DTL (BATCH_NO, ORDERSEQ, BUSINESSNATURE, ORDERSEQ_STATUS, RISKCODE,
	    DATA_TYPE, CORE_NO, DELETE_FLAG, REMARK, DATA_SOURCE, ICREATE, DCREATE, IUPDATE, DUPDATE)
	  values (#batchNo:VARCHAR#, #orderseq:VARCHAR#, #businessnature:VARCHAR#,
	    #orderseqStatus:VARCHAR#, #riskcode:VARCHAR#, #dataType:VARCHAR#, #coreNo:VARCHAR#,
	    #deleteFlag:VARCHAR#, #remark:VARCHAR#, #dataSource:VARCHAR#, #icreate:VARCHAR#,
	    #dcreate:TIMESTAMP#, #iupdate:VARCHAR#, #dupdate:TIMESTAMP#)
	</insert>
  
	<update id="update" parameterClass="com.tlg.prpins.entity.FirAgtBatchDtl" >
		update <include refid="Utils.prpinsSchema" /> FIR_AGT_BATCH_DTL
		<dynamic prepend="set" >
			<isNotNull prepend="," property="businessnature" >
				BUSINESSNATURE = #businessnature:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="orderseqStatus" >
				ORDERSEQ_STATUS = #orderseqStatus:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="riskcode" >
				RISKCODE = #riskcode:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dataType" >
				DATA_TYPE = #dataType:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="coreNo" >
				CORE_NO = #coreNo:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="deleteFlag" >
				DELETE_FLAG = #deleteFlag:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="remark" >
				REMARK = #remark:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dataSource" >
				DATA_SOURCE = #dataSource:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="icreate" >
				ICREATE = #icreate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dcreate" >
				DCREATE = #dcreate:TIMESTAMP#
			</isNotNull>
			<isNotNull prepend="," property="iupdate" >
				IUPDATE = #iupdate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dupdate" >
				DUPDATE = #dupdate:TIMESTAMP#
			</isNotNull>
		</dynamic>
		where BATCH_NO = #batchNo:VARCHAR#
		and ORDERSEQ = #orderseq:VARCHAR#
	</update>
	
	<!-- mantis：FIR0494，處理人員：CC009，需求單編號：FIR0494_板信回饋檔產生排程規格_新版 START -->
	<update id="updateByParams" parameterClass="java.util.Map">
		update FIR_AGT_BATCH_DTL
		<dynamic prepend="set" >
			<isNotNull prepend="," property="businessnature" >
				BUSINESSNATURE = #businessnature:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="orderseqStatus" >
				ORDERSEQ_STATUS = #orderseqStatus:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="riskcode" >
				RISKCODE = #riskcode:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dataType" >
				DATA_TYPE = #dataType:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="coreNo" >
				CORE_NO = #coreNo:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="deleteFlag" >
				DELETE_FLAG = #deleteFlag:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="remark" >
				REMARK = #remark:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dataSource" >
				DATA_SOURCE = #dataSource:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="icreate" >
				ICREATE = #icreate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dcreate" >
				DCREATE = #dcreate:TIMESTAMP#
			</isNotNull>
			<isNotNull prepend="," property="iupdate" >
				IUPDATE = #iupdate:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dupdate" >
				DUPDATE = #dupdate:TIMESTAMP#
			</isNotNull>
		</dynamic>
		<dynamic prepend="WHERE">
	    	<isNotNull prepend="AND" property="batchNo">
	        	BATCH_NO = #batchNo:VARCHAR#
	      	</isNotNull>
	      	<isNotNull prepend="AND" property="orderseq">
	        	ORDERSEQ = #orderseq:VARCHAR#
	      	</isNotNull>
    	</dynamic>
	</update>
	<!-- mantis：FIR0494，處理人員：CC009，需求單編號：FIR0494_板信回饋檔產生排程規格_新版 END -->
	
	<!-- mantis：FIR0495，處理人員：CC009，需求單編號：FIR0495_住火-APS板信回饋檔-排程查詢作業 start -->
	<select id="selectForAps038Detail01" resultMap="aps038DetailVoResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
		SELECT DTL.BATCH_NO, DTL.ORDERSEQ, DTL.ORDERSEQ_STATUS, DTL.RISKCODE, DTL.DATA_TYPE, DTL.CORE_NO, 
			PM.STARTDATE, PINS.INSUREDNAME, PM.EXTRACOMCODE, PM.COMCODE, PM.HANDLER1NAME
		FROM FIR_AGT_BATCH_DTL DTL
		LEFT JOIN PRPTMAIN PM ON DTL.CORE_NO = PM.PROPOSALNO
		LEFT JOIN 
			(SELECT PROPOSALNO, MIN(SERIALNO) AS SERIALNO 
			FROM PRPTINSURED WHERE RISKCODE IN ('F01', 'F02') AND INSUREDFLAG = '1' 
			GROUP BY PROPOSALNO) 
			PINS_SNO ON PM.PROPOSALNO = PINS_SNO.PROPOSALNO
		LEFT JOIN PRPTINSURED PINS ON PINS.PROPOSALNO = PINS_SNO.PROPOSALNO AND PINS.SERIALNO = PINS_SNO.SERIALNO
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
		</dynamic>
		<include refid="Utils.sql2" />
	</select>
	
	<select id="countForAps038Detail01" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*) 
		FROM FIR_AGT_BATCH_DTL DTL
		LEFT JOIN PRPTMAIN PM ON DTL.CORE_NO = PM.PROPOSALNO
		LEFT JOIN 
			(SELECT PROPOSALNO, MIN(SERIALNO) AS SERIALNO 
			FROM PRPTINSURED WHERE RISKCODE IN ('F01', 'F02') AND INSUREDFLAG = '1' 
			GROUP BY PROPOSALNO) 
			PINS_SNO ON PM.PROPOSALNO = PINS_SNO.PROPOSALNO
		LEFT JOIN PRPTINSURED PINS ON PINS.PROPOSALNO = PINS_SNO.PROPOSALNO AND PINS.SERIALNO = PINS_SNO.SERIALNO
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="selectForAps038Detail03" resultMap="aps038DetailVoResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
		SELECT DTL.BATCH_NO, DTL.ORDERSEQ, DTL.ORDERSEQ_STATUS, DTL.RISKCODE, DTL.DATA_TYPE, 
			DTL.CORE_NO, PM.STARTDATE, PINS.INSUREDNAME, PM.EXTRACOMCODE, PM.COMCODE, PM.HANDLER1NAME
		FROM FIR_AGT_BATCH_DTL DTL
		LEFT JOIN PRPCMAIN PM ON DTL.CORE_NO = PM.POLICYNO
		LEFT JOIN 
			(SELECT POLICYNO, MIN(SERIALNO) AS SERIALNO 
    		FROM PRPCINSURED WHERE RISKCODE IN ('F01', 'F02') AND INSUREDFLAG = '1' 
    		GROUP BY POLICYNO) 
    		PINS_SNO ON PM.POLICYNO = PINS_SNO.POLICYNO
		LEFT JOIN PRPCINSURED PINS ON PINS.POLICYNO = PINS_SNO.POLICYNO AND PINS.SERIALNO = PINS_SNO.SERIALNO
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
		</dynamic>
		<include refid="Utils.sql2" />
	</select>
	
	<select id="countForAps038Detail03" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*) 
		FROM FIR_AGT_BATCH_DTL DTL
		LEFT JOIN PRPCMAIN PM ON DTL.CORE_NO = PM.POLICYNO
		LEFT JOIN 
			(SELECT POLICYNO, MIN(SERIALNO) AS SERIALNO 
    		FROM PRPCINSURED WHERE RISKCODE IN ('F01', 'F02') AND INSUREDFLAG = '1' 
    		GROUP BY POLICYNO) 
    		PINS_SNO ON PM.POLICYNO = PINS_SNO.POLICYNO
		LEFT JOIN PRPCINSURED PINS ON PINS.POLICYNO = PINS_SNO.POLICYNO AND PINS.SERIALNO = PINS_SNO.SERIALNO
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
		</dynamic>
	</select>
	<!-- mantis：FIR0495，處理人員：CC009，需求單編號：FIR0495_住火-APS板信回饋檔-排程查詢作業 end -->
	
	<!-- mantis：FIR0547，處理人員：CC009，需求單編號：FIR0547 聯邦新件資料交換查詢作業 start -->
	<select id="selectForAps041Dtl1" resultMap="aps041DetailVo1ResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
		SELECT DTL.ORDERSEQ, UB01.RISKCODE, UB01.STARTDATE, UB01.INSURED_NAME, UB01.BRANCH_NAME, UB01.BRANCH_NO,  
		PM.POLICYNO, PM.UNDERWRITEENDDATE, UB01.IS_PDF 
		FROM FIR_AGT_BATCH_DTL DTL 
		LEFT JOIN FIR_AGT_UB_01 UB01 ON DTL.BATCH_NO = UB01.BATCH_NO AND DTL.ORDERSEQ = UB01.ORDERSEQ 
		LEFT JOIN PRPCMAIN PM ON DTL.ORDERSEQ = PM.ORDERSEQ 
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
		</dynamic>
		<isNotEmpty prepend=" " property="sortBy">
			ORDER BY  $sortBy$ $sortType$
		</isNotEmpty>
		) A ))WHERE RN BETWEEN $startRow$ AND $endRow$
	</select>
	
	<select id="countForAps041Dtl1" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		SELECT COUNT(*)
		FROM FIR_AGT_BATCH_DTL DTL 
		LEFT JOIN FIR_AGT_UB_01 UB01 ON DTL.BATCH_NO = UB01.BATCH_NO AND DTL.ORDERSEQ = UB01.ORDERSEQ 
		LEFT JOIN PRPCMAIN PM ON DTL.ORDERSEQ = PM.ORDERSEQ 
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchNo">
				DTL.BATCH_NO = #batchNo#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="selectForAps041Dtl2" resultMap="aps041DetailVo2ResultMap" parameterClass="java.util.Map">
		<include refid="Utils.sql1" />
		SELECT DTL.* , UB02.STARTDATE, UB02.UNDERWRITEENDDATE, UB02.INSURED_NAME, UB02.ORDER_TYPE, UB02.POLICYNO, PM.EXTRACOMNAME AS BRANCH_NAME 
		FROM (
		    SELECT BATCH_NO, ORDERSEQ, ORDERSEQ_STATUS, RISKCODE, CORE_NO
		    FROM FIR_AGT_BATCH_DTL DTL
		    WHERE BATCH_NO = #batchNo# AND DATA_TYPE = '2'
		) DTL
		LEFT JOIN FIR_AGT_UB_02 UB02 ON DTL.BATCH_NO = UB02.BATCH_NO AND DTL.CORE_NO = UB02.POLICYNO AND UB02.ENDORSENO IS NULL
		LEFT JOIN PRPCMAIN PM ON UB02.POLICYNO = PM.POLICYNO
		WHERE DTL.BATCH_NO = #batchNo#
		UNION ALL 
		SELECT DTL.* ,UB02.STARTDATE, UB02.UNDERWRITEENDDATE, UB02.INSURED_NAME, UB02.ORDER_TYPE, UB02.POLICYNO, PM.EXTRACOMNAME AS BRANCH_NAME 
		FROM (
		    SELECT BATCH_NO, ORDERSEQ, ORDERSEQ_STATUS, RISKCODE, CORE_NO
		    FROM FIR_AGT_BATCH_DTL DTL
		    WHERE BATCH_NO = #batchNo# AND DATA_TYPE = '3'
		) DTL
		LEFT JOIN FIR_AGT_UB_02 UB02 ON DTL.BATCH_NO = UB02.BATCH_NO AND DTL.CORE_NO = UB02.ENDORSENO
		LEFT JOIN PRPCMAIN PM ON UB02.POLICYNO = PM.POLICYNO
		WHERE DTL.BATCH_NO = #batchNo#
		) A ))WHERE RN BETWEEN $startRow$ AND $endRow$
		<isNotEmpty prepend=" " property="sortBy">
			ORDER BY  $sortBy$ $sortType$
		</isNotEmpty>
	</select>
	
	<select id="countForAps041Dtl2" resultClass="java.lang.Integer" parameterClass="java.util.Map">
		select COUNT(*) from (
		SELECT DTL.* , UB02.STARTDATE, UB02.UNDERWRITEENDDATE, UB02.INSURED_NAME, UB02.ORDER_TYPE, UB02.POLICYNO, PM.EXTRACOMNAME AS BRANCH_NAME 
		FROM (
		    SELECT BATCH_NO, ORDERSEQ, ORDERSEQ_STATUS, RISKCODE, CORE_NO
		    FROM FIR_AGT_BATCH_DTL DTL
		    WHERE BATCH_NO = #batchNo# AND DATA_TYPE = '2'
		) DTL
		LEFT JOIN FIR_AGT_UB_02 UB02 ON DTL.BATCH_NO = UB02.BATCH_NO AND DTL.CORE_NO = UB02.POLICYNO AND UB02.ENDORSENO IS NULL
		LEFT JOIN PRPCMAIN PM ON UB02.POLICYNO = PM.POLICYNO
		WHERE DTL.BATCH_NO = #batchNo#
		UNION ALL 
		SELECT DTL.* ,UB02.STARTDATE, UB02.UNDERWRITEENDDATE, UB02.INSURED_NAME, UB02.ORDER_TYPE, UB02.POLICYNO, PM.EXTRACOMNAME AS BRANCH_NAME 
		FROM (
		    SELECT BATCH_NO, ORDERSEQ, ORDERSEQ_STATUS, RISKCODE, CORE_NO
		    FROM FIR_AGT_BATCH_DTL DTL
		    WHERE BATCH_NO = #batchNo# AND DATA_TYPE = '3'
		) DTL
		LEFT JOIN FIR_AGT_UB_02 UB02 ON DTL.BATCH_NO = UB02.BATCH_NO AND DTL.CORE_NO = UB02.ENDORSENO
		LEFT JOIN PRPCMAIN PM ON UB02.POLICYNO = PM.POLICYNO
		WHERE DTL.BATCH_NO = #batchNo#
		)
	</select>
	<!-- mantis：FIR0547，處理人員：CC009，需求單編號：FIR0547 聯邦新件資料交換查詢作業 end -->

    <!-- mantis：FIR0545，處理人員：BJ085，需求單編號：FIR0545 火險_聯邦新件_APS要保資料接收排程 start -->
    <select id="selectByUK" resultMap="BaseResultMap" parameterClass="java.util.Map">
		SELECT * FROM FIR_AGT_BATCH_DTL
		WHERE BATCH_NO = #batchNo:VARCHAR#
	    AND ORDERSEQ = #orderseq:VARCHAR#
	    AND CORE_NO =#coreNo:VARCHAR#
    </select>
    
    <select id="selectForUbProposalEmail" resultMap="ubProposalDtlResultMap" parameterClass="java.util.Map">
		SELECT DTL.RISKCODE, DTL.ORDERSEQ, DTL.REMARK, UB01.IS_PDF, DTL.BATCH_NO
		FROM FIR_AGT_BATCH_DTL DTL
		LEFT JOIN FIR_AGT_UB_01 UB01 ON DTL.BATCH_NO = UB01.BATCH_NO AND DTL.ORDERSEQ = UB01.ORDERSEQ
		WHERE DTL.BATCH_NO = #batchNo:VARCHAR#
		ORDER BY DTL.ORDERSEQ
	</select>
	
	<select id="countByUK" resultClass="java.lang.Integer" parameterClass="com.tlg.prpins.entity.FirAgtBatchDtl" >
		SELECT COUNT(*) FROM <include refid="Utils.prpinsSchema"/>FIR_AGT_BATCH_DTL
		where BATCH_NO = #batchNo:VARCHAR#
		AND ORDERSEQ = #orderseq:VARCHAR#
	    AND CORE_NO =#coreNo:VARCHAR#
	</select>
	<!-- mantis：FIR0545，處理人員：BJ085，需求單編號：FIR0545 火險_聯邦新件_APS要保資料接收排程 end -->
	
	<!-- mantis：FIR0546，處理人員：BJ085，需求單編號：FIR0546 火險_聯邦新件_APS回饋檔產生排程 start -->
	<select id="selectForUbBackFile" resultMap="ub02ResultMap" parameterClass="java.util.Map">
		SELECT UB.* FROM (
		    SELECT UB02.*
		    FROM FIR_AGT_BATCH_DTL DTL
		    INNER JOIN FIR_AGT_UB_02 UB02 ON DTL.BATCH_NO = UB02.BATCH_NO
		        AND DTL.ORDERSEQ = UB02.ORDERSEQ AND DTL.CORE_NO = UB02.POLICYNO
		    WHERE DTL.BATCH_NO = #batchNo:VARCHAR# AND DTL.DATA_TYPE = '2'
		    AND UB02.ENDORSENO IS NULL AND DTL.ORDERSEQ_STATUS IN ('01','02')
		    UNION
		    SELECT UB02.*
		    FROM FIR_AGT_BATCH_DTL DTL
		    INNER JOIN FIR_AGT_UB_02 UB02 ON DTL.BATCH_NO = UB02.BATCH_NO AND DTL.ORDERSEQ = UB02.ORDERSEQ
		        AND DTL.CORE_NO = UB02.ENDORSENO
		    WHERE DTL.BATCH_NO = #batchNo:VARCHAR# AND DTL.DATA_TYPE = '3'
		    AND DTL.ORDERSEQ_STATUS IN ('01','02')
		) UB
		ORDER BY UB.OID
	</select>
	
	<select id="selectForUbBackFileEmail" resultMap="ubBackFileDtlResultMap" parameterClass="java.util.Map">
		SELECT ORDERSEQ, 
		CASE ORDERSEQ_STATUS WHEN '00' THEN '未處理' WHEN '01' THEN '資料產生成功' 
		WHEN '02' THEN '檔案產生成功' ELSE '未定義' END AS ORDERSEQ_STATUS, CORE_NO, RISKCODE,
		CASE DATA_TYPE WHEN '1' THEN '要保書' WHEN '2' THEN '保單' 
		WHEN '3' THEN '批單' ELSE '未定義' END AS DATA_TYPE
		FROM FIR_AGT_BATCH_DTL
		WHERE BATCH_NO = #batchNo:VARCHAR#
		ORDER BY RISKCODE, ORDERSEQ, CORE_NO
	</select>
	<!-- mantis：FIR0546，處理人員：BJ085，需求單編號：FIR0546 火險_聯邦新件_APS回饋檔產生排程 end -->

</sqlMap>